!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.kyxbotDatabase=t():e.kyxbotDatabase=t()}(this,(()=>(()=>{var e={371:(e,t,n)=>{n(738).config(Object.assign({},n(547),n(962)(process.argv)))},962:e=>{const t=/^dotenv_config_(encoding|path|debug|override|DOTENV_KEY)=(.+)$/;e.exports=function(e){return e.reduce((function(e,n){const r=n.match(t);return r&&(e[r[1]]=r[2]),e}),{})}},547:e=>{const t={};null!=process.env.DOTENV_CONFIG_ENCODING&&(t.encoding=process.env.DOTENV_CONFIG_ENCODING),null!=process.env.DOTENV_CONFIG_PATH&&(t.path=process.env.DOTENV_CONFIG_PATH),null!=process.env.DOTENV_CONFIG_DEBUG&&(t.debug=process.env.DOTENV_CONFIG_DEBUG),null!=process.env.DOTENV_CONFIG_OVERRIDE&&(t.override=process.env.DOTENV_CONFIG_OVERRIDE),null!=process.env.DOTENV_CONFIG_DOTENV_KEY&&(t.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY),e.exports=t},738:(e,t,n)=>{const r=n(147),s=n(17),i=n(37),a=n(113),o=n(968).version,l=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function c(e){console.log(`[dotenv@${o}][DEBUG] ${e}`)}function u(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function d(e,t){let n;try{n=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code)throw new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenv.org/vault/.env.vault?environment=development");throw e}const r=n.password;if(!r)throw new Error("INVALID_DOTENV_KEY: Missing key part");const s=n.searchParams.get("environment");if(!s)throw new Error("INVALID_DOTENV_KEY: Missing environment part");const i=`DOTENV_VAULT_${s.toUpperCase()}`,a=e.parsed[i];if(!a)throw new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);return{ciphertext:a,key:r}}function h(e){let t=s.resolve(process.cwd(),".env");return e&&e.path&&e.path.length>0&&(t=e.path),t.endsWith(".vault")?t:`${t}.vault`}const p={configDotenv:function(e){let t=s.resolve(process.cwd(),".env"),n="utf8";const a=Boolean(e&&e.debug);var o;e&&(null!=e.path&&(t="~"===(o=e.path)[0]?s.join(i.homedir(),o.slice(1)):o),null!=e.encoding&&(n=e.encoding));try{const s=p.parse(r.readFileSync(t,{encoding:n}));let i=process.env;return e&&null!=e.processEnv&&(i=e.processEnv),p.populate(i,s,e),{parsed:s}}catch(e){return a&&c(`Failed to load ${t} ${e.message}`),{error:e}}},_configVault:function(e){console.log(`[dotenv@${o}][INFO] Loading env from encrypted .env.vault`);const t=p._parseVault(e);let n=process.env;return e&&null!=e.processEnv&&(n=e.processEnv),p.populate(n,t,e),{parsed:t}},_parseVault:function(e){const t=h(e),n=p.configDotenv({path:t});if(!n.parsed)throw new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);const r=u(e).split(","),s=r.length;let i;for(let e=0;e<s;e++)try{const t=d(n,r[e].trim());i=p.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=s)throw t}return p.parse(i)},config:function(e){const t=h(e);return 0===u(e).length?p.configDotenv(e):r.existsSync(t)?p._configVault(e):(n=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${o}][WARN] ${n}`),p.configDotenv(e));var n},decrypt:function(e,t){const n=Buffer.from(t.slice(-64),"hex");let r=Buffer.from(e,"base64");const s=r.slice(0,12),i=r.slice(-16);r=r.slice(12,-16);try{const e=a.createDecipheriv("aes-256-gcm",n,s);return e.setAuthTag(i),`${e.update(r)}${e.final()}`}catch(e){const t=e instanceof RangeError,n="Invalid key length"===e.message,r="Unsupported state or unable to authenticate data"===e.message;if(t||n)throw new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");if(r)throw new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw console.error("Error: ",e.code),console.error("Error: ",e.message),e}},parse:function(e){const t={};let n,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(n=l.exec(r));){const e=n[1];let r=n[2]||"";r=r.trim();const s=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===s&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),t[e]=r}return t},populate:function(e,t,n={}){const r=Boolean(n&&n.debug),s=Boolean(n&&n.override);if("object"!=typeof t)throw new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");for(const n of Object.keys(t))Object.prototype.hasOwnProperty.call(e,n)?(!0===s&&(e[n]=t[n]),r&&c(!0===s?`"${n}" is already defined and WAS overwritten`:`"${n}" is already defined and was NOT overwritten`)):e[n]=t[n]}};e.exports.configDotenv=p.configDotenv,e.exports._configVault=p._configVault,e.exports._parseVault=p._parseVault,e.exports.config=p.config,e.exports.decrypt=p.decrypt,e.exports.parse=p.parse,e.exports.populate=p.populate,e.exports=p},113:e=>{"use strict";e.exports=require("crypto")},147:e=>{"use strict";e.exports=require("fs")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},968:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.3.1","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","lint-readme":"standard-markdown","pretest":"npm run lint && npm run dts-check","test":"tap tests/*.js --100 -Rspec","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"funding":"https://github.com/motdotla/dotenv?sponsor=1","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@definitelytyped/dtslint":"^0.0.133","@types/node":"^18.11.3","decache":"^4.6.1","sinon":"^14.0.1","standard":"^17.0.0","standard-markdown":"^7.1.0","standard-version":"^9.5.0","tap":"^16.3.0","tar":"^6.1.11","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{addGeneration:()=>Ea,addGenerationResults:()=>xa,addUserRole:()=>za,client:()=>so,createGuildSettings:()=>ja,createNewUser:()=>Ha,createPermissions:()=>Ia,createUpscaledImage:()=>Wa,db:()=>io,discordIdSchema:()=>Ji,findPermission:()=>Ma,getAmountOfPagesForUser:()=>ka,getGenerationResultsFromUser:()=>Na,getGenerationResultsFromUserPaginated:()=>Ta,getGenerationResultsFromUserWithinGuild:()=>Oa,getGuildSettings:()=>Pa,getModRoles:()=>Ba,getPermissionsForGuildAndGroup:()=>Za,getUploadedImageByName:()=>Ga,getUploadedImages:()=>Ka,getUpscaledImage:()=>Ja,getUserByDiscordId:()=>Ya,getUserInformation:()=>eo,getUserInformationInGuild:()=>to,getUserPrivileges:()=>Qa,getUserRoles:()=>Ra,guild_settings:()=>Li,hasAccess:()=>Ua,imageGenerationRelations:()=>Xi,imageGenerationResultsRelations:()=>na,image_generation_results:()=>ea,image_generations:()=>Wi,insertGuildSettingsSchema:()=>Bi,insertImageGenerationResultSchema:()=>ta,insertImageGenerationSchema:()=>Yi,insertPermissionsSchema:()=>ca,insertUploadedImage:()=>Va,insertUploadedImageSchema:()=>pa,insertUpscaledImageSchema:()=>ma,insertUserInformation:()=>Xa,insertUserInformationSchema:()=>ba,insertUserSchema:()=>Ki,onlyNecessaryUserInformationSchema:()=>wa,permissions:()=>oa,removeModRole:()=>Da,removeUserRole:()=>La,resetPermissions:()=>Fa,roleEnum:()=>aa,roleSchema:()=>ua,selectGuildSettingsSchema:()=>Ri,selectImageGenerationSchema:()=>Hi,selectPermissionsSchema:()=>la,selectUploadedImageSchema:()=>ha,selectUpscaledImageSchema:()=>ga,selectUserInformationSchema:()=>Sa,selectUserSchema:()=>Gi,setModRole:()=>qa,updateGenerationStatus:()=>$a,updateGuildSettings:()=>Aa,uploaded_images:()=>da,upscaled_images:()=>fa,upsertGuildSettings:()=>Ca,userInformations:()=>_a,users:()=>Vi});const e=Symbol.for("drizzle:entityKind");function t(t,n){if(!t||"object"!=typeof t)return!1;if(t instanceof n)return!0;if(!Object.prototype.hasOwnProperty.call(n,e))throw new Error(`Class "${n.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=t.constructor;if(r)for(;r;){if(e in r&&r[e]===n[e])return!0;r=Object.getPrototypeOf(r)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class s{static[e]="ConsoleLogWriter";write(e){console.log(e)}}class i{static[e]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new s}logQuery(e,t){const n=t.map((e=>{try{return JSON.stringify(e)}catch{return String(e)}})),r=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${r}`)}}class a{static[e]="NoopLogger";logQuery(){}}class o{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}static[e]="Column";name;primary;notNull;default;defaultFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}}const l=Symbol.for("drizzle:Name"),c=Symbol.for("drizzle:Schema"),u=Symbol.for("drizzle:Columns"),d=Symbol.for("drizzle:OriginalName"),h=Symbol.for("drizzle:BaseName"),p=Symbol.for("drizzle:IsAlias"),f=Symbol.for("drizzle:ExtraConfigBuilder"),m=Symbol.for("drizzle:IsDrizzleTable");class g{static[e]="Table";static Symbol={Name:l,Schema:c,OriginalName:d,Columns:u,BaseName:h,IsAlias:p,ExtraConfigBuilder:f};[l];[d];[c];[u];[h];[p]=!1;[f]=void 0;[m]=!0;constructor(e,t,n){this[l]=this[d]=e,this[c]=t,this[h]=n}}function y(e){return e[l]}const v=Symbol.for("drizzle:PgInlineForeignKeys");class _ extends g{static[e]="PgTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:v});[v]=[];[g.Symbol.ExtraConfigBuilder]=void 0}const b=(e,t,n)=>function(e,t,n,r,s=e){const i=new _(e,r,s),a=Object.fromEntries(Object.entries(t).map((([e,t])=>{const n=t,r=n.build(i);return i[v].push(...n.buildForeignKeys(r,i)),[e,r]}))),o=Object.assign(i,a);return o[g.Symbol.Columns]=a,n&&(o[_.Symbol.ExtraConfigBuilder]=n),o}(e,t,n,void 0);function w(...e){return e[0].columns?new S(e[0].columns,e[0].name):new S(e)}class S{static[e]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new x(e,this.columns,this.name)}}class x{constructor(e,t,n){this.table=e,this.columns=t,this.name=n}static[e]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[_.Symbol.Name]}_${this.columns.map((e=>e.name)).join("_")}_pk`}}function N(e,n){return!function(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}(n)||ce(e)||t(e,me)||t(e,ve)||t(e,o)||t(e,g)||t(e,be)?e:new me(e,n)}const T=(e,t)=>ge`${e} = ${N(t,e)}`,O=(e,t)=>ge`${e} <> ${N(t,e)}`;function k(...e){const t=e.filter((e=>void 0!==e));if(0!==t.length)return 1===t.length?new de(t):new de([new ue("("),ge.join(t,new ue(" and ")),new ue(")")])}function E(...e){const t=e.filter((e=>void 0!==e));if(0!==t.length)return 1===t.length?new de(t):new de([new ue("("),ge.join(t,new ue(" or ")),new ue(")")])}function $(e){return ge`not ${e}`}const j=(e,t)=>ge`${e} > ${N(t,e)}`,P=(e,t)=>ge`${e} >= ${N(t,e)}`,A=(e,t)=>ge`${e} < ${N(t,e)}`,C=(e,t)=>ge`${e} <= ${N(t,e)}`;function I(e,t){if(Array.isArray(t)){if(0===t.length)throw new Error("inArray requires at least one value");return ge`${e} in ${t.map((t=>N(t,e)))}`}return ge`${e} in ${N(t,e)}`}function q(e,t){if(Array.isArray(t)){if(0===t.length)throw new Error("notInArray requires at least one value");return ge`${e} not in ${t.map((t=>N(t,e)))}`}return ge`${e} not in ${N(t,e)}`}function D(e){return ge`${e} is null`}function z(e){return ge`${e} is not null`}function L(e){return ge`exists ${e}`}function B(e){return ge`not exists ${e}`}function R(e,t,n){return ge`${e} between ${N(t,e)} and ${N(n,e)}`}function Z(e,t,n){return ge`${e} not between ${N(t,e)} and ${N(n,e)}`}function M(e,t){return ge`${e} like ${t}`}function U(e,t){return ge`${e} not like ${t}`}function Q(e,t){return ge`${e} ilike ${t}`}function F(e,t){return ge`${e} not ilike ${t}`}function V(e){return ge`${e} asc`}function K(e){return ge`${e} desc`}class G{constructor(e,t,n){this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[g.Symbol.Name]}static[e]="Relation";referencedTableName;fieldName}class J{constructor(e,t){this.table=e,this.config=t}static[e]="Relations"}class W extends G{constructor(e,t,n,r){super(e,t,n?.relationName),this.config=n,this.isNullable=r}static[e]="One";withFieldName(e){const t=new W(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}}class Y extends G{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}static[e]="Many";withFieldName(e){const t=new Y(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}function H(e,t){return new J(e,(e=>Object.fromEntries(Object.entries(t(e)).map((([e,t])=>[e,t.withFieldName(e)])))))}function X(e){return function(t,n){return new W(e,t,n,n?.fields.reduce(((e,t)=>e&&t.notNull),!0)??!1)}}function ee(e){return function(t,n){return new Y(e,t,n)}}function te(e,n,r){if(t(r,W)&&r.config)return{fields:r.config.fields,references:r.config.references};const s=n[r.referencedTable[g.Symbol.Name]];if(!s)throw new Error(`Table "${r.referencedTable[g.Symbol.Name]}" not found in schema`);const i=e[s];if(!i)throw new Error(`Table "${s}" not found in schema`);const a=r.sourceTable,o=n[a[g.Symbol.Name]];if(!o)throw new Error(`Table "${a[g.Symbol.Name]}" not found in schema`);const l=[];for(const e of Object.values(i.relations))(r.relationName&&r!==e&&e.relationName===r.relationName||!r.relationName&&e.referencedTable===r.sourceTable)&&l.push(e);if(l.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${r.sourceTable[g.Symbol.Name]}". Please specify relation name`);if(l[0]&&t(l[0],W)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${r.fieldName}"`)}function ne(e){return{one:X(e),many:ee(e)}}function re(e,n,r,s,i=(e=>e)){const a={};for(const[l,c]of s.entries())if(c.isJson){const s=n.relations[c.tsKey],o=r[l],u="string"==typeof o?JSON.parse(o):o;a[c.tsKey]=t(s,W)?u&&re(e,e[c.relationTableTsKey],u,c.selection,i):u.map((t=>re(e,e[c.relationTableTsKey],t,c.selection,i)))}else{const e=i(r[l]),n=c.field;let s;s=t(n,o)?n:t(n,de)?n.decoder:n.sql.decoder,a[c.tsKey]=null===e?null:s.mapFromDriverValue(e)}return a}const se=Symbol.for("drizzle:SubqueryConfig");class ie{static[e]="Subquery";[se];constructor(e,t,n,r=!1){this[se]={sql:e,selection:t,alias:n,isWith:r}}}class ae extends ie{static[e]="WithSubquery"}const oe=(e,t)=>t(),le=Symbol.for("drizzle:ViewBaseConfig");function ce(e){return"object"==typeof e&&null!==e&&"getSQL"in e&&"function"==typeof e.getSQL}class ue{static[e]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new de([this])}}class de{constructor(e){this.queryChunks=e}static[e]="SQL";decoder=pe;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return oe("drizzle.buildSQL",(t=>{const n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n}))}buildQueryFromSourceParams(e,n){const r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{escapeName:s,escapeParam:i,prepareTyping:a,inlineParams:l,paramStartIndex:c}=r;return function(e){const t={sql:"",params:[]};for(const n of e)t.sql+=n.sql,t.params.push(...n.params),n.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...n.typings));return t}(e.map((e=>{if(t(e,ue))return{sql:e.value.join(""),params:[]};if(t(e,he))return{sql:s(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){const t=[new ue("(")];for(const[n,r]of e.entries())t.push(r),n<e.length-1&&t.push(new ue(", "));return t.push(new ue(")")),this.buildQueryFromSourceParams(t,r)}if(t(e,de))return this.buildQueryFromSourceParams(e.queryChunks,{...r,inlineParams:l||e.shouldInlineParams});if(t(e,g)){const t=e[g.Symbol.Schema],n=e[g.Symbol.Name];return{sql:void 0===t?s(n):s(t)+"."+s(n),params:[]}}if(t(e,o))return{sql:s(e.table[g.Symbol.Name])+"."+s(e.name),params:[]};if(t(e,be)){const t=e[le].schema,n=e[le].name;return{sql:void 0===t?s(n):s(t)+"."+s(n),params:[]}}if(t(e,me)){const n=null===e.value?null:e.encoder.mapToDriverValue(e.value);if(t(n,de))return this.buildQueryFromSourceParams([n],r);if(l)return{sql:this.mapInlineParam(n,r),params:[]};let s;return void 0!==a&&(s=[a(e.encoder)]),{sql:i(c.value++,n),params:[n],typings:s}}return t(e,ve)?{sql:i(c.value++,e),params:[e]}:t(e,de.Aliased)&&void 0!==e.fieldAlias?{sql:s(e.fieldAlias),params:[]}:t(e,ie)?e[se].isWith?{sql:s(e[se].alias),params:[]}:this.buildQueryFromSourceParams([new ue("("),e[se].sql,new ue(") "),new he(e[se].alias)],r):ce(e)?this.buildQueryFromSourceParams([new ue("("),e.getSQL(),new ue(")")],r):t(e,G)?this.buildQueryFromSourceParams([e.sourceTable,new ue("."),ge.identifier(e.fieldName)],r):l?{sql:this.mapInlineParam(e,r),params:[]}:{sql:i(c.value++,e),params:[e]}})))}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){const n=e.toString();return t("[object Object]"===n?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new de.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}}class he{constructor(e){this.value=e}static[e]="Name";brand;getSQL(){return new de([this])}}const pe={mapFromDriverValue:e=>e},fe={mapToDriverValue:e=>e};class me{constructor(e,t=fe){this.value=e,this.encoder=t}static[e]="Param";brand;getSQL(){return new de([this])}}function ge(e,...t){const n=[];(t.length>0||e.length>0&&""!==e[0])&&n.push(new ue(e[0]));for(const[r,s]of t.entries())n.push(s,new ue(e[r+1]));return new de(n)}var ye;(ye=ge||(ge={})).empty=function(){return new de([])},ye.fromList=function(e){return new de(e)},ye.raw=function(e){return new de([new ue(e)])},ye.join=function(e,t){const n=[];for(const[r,s]of e.entries())r>0&&void 0!==t&&n.push(t),n.push(s);return new de(n)},ye.identifier=function(e){return new he(e)},ye.placeholder=function(e){return new ve(e)},ye.param=function(e,t){return new me(e,t)},(t=>{class n{constructor(e,t){this.sql=e,this.fieldAlias=t}static[e]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}}t.Aliased=n})(de||(de={}));class ve{constructor(e){this.name=e}static[e]="Placeholder";getSQL(){return new de([this])}}function _e(e,n){return e.map((e=>{if(t(e,ve)){if(!(e.name in n))throw new Error(`No value for placeholder "${e.name}" was provided`);return n[e.name]}return e}))}class be{static[e]="View";[le];constructor({name:e,schema:t,selectedFields:n,query:r}){this[le]={name:e,originalName:e,schema:t,selectedFields:n,query:r,isExisting:!r,isAlias:!1}}getSQL(){return new de([this])}}o.prototype.getSQL=function(){return new de([this])},g.prototype.getSQL=function(){return new de([this])},ie.prototype.getSQL=function(){return new de([this])};class we{constructor(e){this.table=e}static[e]="ColumnAliasProxyHandler";get(e,t){return"table"===t?this.table:e[t]}}class Se{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[e]="TableAliasProxyHandler";get(e,n){if(n===g.Symbol.IsAlias)return!0;if(n===g.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===g.Symbol.OriginalName)return this.alias;if(n===le)return{...e[le],name:this.alias,isAlias:!0};if(n===g.Symbol.Columns){const t=e[g.Symbol.Columns];if(!t)return t;const n={};return Object.keys(t).map((r=>{n[r]=new Proxy(t[r],new we(new Proxy(e,this)))})),n}const r=e[n];return t(r,o)?new Proxy(r,new we(new Proxy(e,this))):r}}function xe(e,t){return new Proxy(e,new Se(t,!1))}function Ne(e,t){return new Proxy(e,new we(new Proxy(e.table,new Se(t,!1))))}function Te(e,t){return new de.Aliased(Oe(e.sql,t),e.fieldAlias)}function Oe(e,n){return ge.join(e.queryChunks.map((e=>t(e,o)?Ne(e,n):t(e,de)?Oe(e,n):t(e,de.Aliased)?Te(e,n):e)))}class ke extends Error{static[e]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}}class Ee extends ke{static[e]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class $e{static[e]="ColumnBuilder";config;constructor(e,t,n){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}}class je{static[e]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{const{name:t,columns:n,foreignColumns:r}=e();return{name:t,columns:n,foreignTable:r[0].table,foreignColumns:r}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new Pe(e,this)}}class Pe{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[e]="PgForeignKey";reference;onUpdate;onDelete;getName(){const{name:e,columns:t,foreignColumns:n}=this.reference(),r=t.map((e=>e.name)),s=n.map((e=>e.name)),i=[this.table[_.Symbol.Name],...r,n[0].table[_.Symbol.Name],...s];return e??`${i.join("_")}_fk`}}function Ae(e,t,n){for(let r=t;r<e.length;r++){const s=e[r];if("\\"!==s){if('"'===s)return[e.slice(t,r).replace(/\\/g,""),r+1];if(!n&&(","===s||"}"===s))return[e.slice(t,r).replace(/\\/g,""),r]}else r++}return[e.slice(t).replace(/\\/g,""),e.length]}function Ce(e,t=0){const n=[];let r=t,s=!1;for(;r<e.length;){const i=e[r];if(","===i){(s||r===t)&&n.push(""),s=!0,r++;continue}if(s=!1,"\\"===i){r+=2;continue}if('"'===i){const[t,s]=Ae(e,r+1,!0);n.push(t),r=s;continue}if("}"===i)return[n,r+1];if("{"===i){const[t,s]=Ce(e,r+1);n.push(t),r=s;continue}const[a,o]=Ae(e,r,!1);n.push(a),r=o}return[n,r]}function Ie(e){const[t]=Ce(e,1);return t}function qe(e){return`{${e.map((e=>Array.isArray(e)?qe(e):"string"==typeof e?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`)).join(",")}}`}class De extends $e{foreignKeyConfigs=[];static[e]="PgColumnBuilder";array(e){return new Le(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map((({ref:n,actions:r})=>function(e,...t){return e(...t)}(((n,r)=>{const s=new je((()=>{const t=n();return{columns:[e],foreignColumns:[t]}}));return r.onUpdate&&s.onUpdate(r.onUpdate),r.onDelete&&s.onDelete(r.onDelete),s.build(t)}),n,r)))}}class ze extends o{constructor(e,t){t.uniqueName||(t.uniqueName=function(e,t){return`${e[_.Symbol.Name]}_${t.join("_")}_unique`}(e,[t.name])),super(e,t),this.table=e}static[e]="PgColumn"}class Le extends De{static[e]="PgArrayBuilder";constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){const t=this.config.baseBuilder.build(e);return new Be(e,this.config,t)}}class Be extends ze{constructor(e,t,n,r){super(e,t),this.baseColumn=n,this.range=r,this.size=t.size}size;static[e]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=Ie(e)),e.map((e=>this.baseColumn.mapFromDriverValue(e)))}mapToDriverValue(e,n=!1){const r=e.map((e=>null===e?null:t(this.baseColumn,Be)?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e)));return n?r:qe(r)}}class Re extends ze{static[e]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}class Ze extends ze{static[e]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}class Me extends ze{static[e]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class Ue extends ze{static[e]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}class Qe extends De{static[e]="PgDateColumnBaseBuilder";defaultNow(){return this.default(ge`now()`)}}class Fe extends Qe{static[e]="PgTimestampBuilder";constructor(e,t,n){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=n}build(e){return new Ve(e,this.config)}}class Ve extends ze{static[e]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>this.withTimezone?e.toUTCString():e.toISOString()}class Ke extends Qe{static[e]="PgTimestampStringBuilder";constructor(e,t,n){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=n}build(e){return new Ge(e,this.config)}}class Ge extends ze{static[e]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function Je(e,t={}){return"string"===t.mode?new Ke(e,t.withTimezone??!1,t.precision):new Fe(e,t.withTimezone??!1,t.precision)}class We extends ze{static[e]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}class Ye extends ze{static[e]="PgUUID";getSQLType(){return"uuid"}}function He(e,n){return Object.entries(e).reduce(((e,[r,s])=>{if("string"!=typeof r)return e;const i=n?[...n,r]:[r];return t(s,o)||t(s,de)||t(s,de.Aliased)?e.push({path:i,field:s}):t(s,g)?e.push(...He(s[g.Symbol.Columns],i)):e.push(...He(s,i)),e}),[])}function Xe(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const[e,t]of n.entries())if(t!==r[e])return!1;return!0}function et(e,n){const r=Object.entries(n).filter((([,e])=>void 0!==e)).map((([n,r])=>t(r,de)?[n,r]:[n,new me(r,e[g.Symbol.Columns][n])]));if(0===r.length)throw new Error("No values to set");return Object.fromEntries(r)}function tt(e){return e[g.Symbol.Columns]}function nt(e){return t(e,ie)?e[se].alias:t(e,be)?e[le].name:t(e,de)?void 0:e[g.Symbol.IsAlias]?e[g.Symbol.Name]:e[g.Symbol.BaseName]}class rt extends be{static[e]="PgViewBase"}class st{static[e]="PgDialect";async migrate(e,t){const n=ge`
			CREATE TABLE IF NOT EXISTS "drizzle"."__drizzle_migrations" (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(ge`CREATE SCHEMA IF NOT EXISTS "drizzle"`),await t.execute(n);const r=(await t.all(ge`select id, hash, created_at from "drizzle"."__drizzle_migrations" order by created_at desc limit 1`))[0];await t.transaction((async t=>{for await(const n of e)if(!r||Number(r.created_at)<n.folderMillis){for(const e of n.sql)await t.execute(ge.raw(e));await t.execute(ge`insert into "drizzle"."__drizzle_migrations" ("hash", "created_at") values(${n.hash}, ${n.folderMillis})`)}}))}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildDeleteQuery({table:e,where:t,returning:n}){return ge`delete from ${e}${t?ge` where ${t}`:void 0}${n?ge` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0}`}buildUpdateSet(e,t){const n=Object.entries(t),r=n.length;return ge.join(n.flatMap((([t,n],s)=>{const i=e[g.Symbol.Columns][t],a=ge`${ge.identifier(i.name)} = ${n}`;return s<r-1?[a,ge.raw(", ")]:[a]})))}buildUpdateQuery({table:e,set:t,where:n,returning:r}){return ge`update ${e} set ${this.buildUpdateSet(e,t)}${n?ge` where ${n}`:void 0}${r?ge` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0}`}buildSelection(e,{isSingleTable:n=!1}={}){const r=e.length,s=e.flatMap((({field:e},s)=>{const i=[];if(t(e,de.Aliased)&&e.isSelectionField)i.push(ge.identifier(e.fieldAlias));else if(t(e,de.Aliased)||t(e,de)){const r=t(e,de.Aliased)?e.sql:e;n?i.push(new de(r.queryChunks.map((e=>t(e,ze)?ge.identifier(e.name):e)))):i.push(r),t(e,de.Aliased)&&i.push(ge` as ${ge.identifier(e.fieldAlias)}`)}else t(e,o)&&(n?i.push(ge.identifier(e.name)):i.push(e));return s<r-1&&i.push(ge`, `),i}));return ge.join(s)}buildSelectQuery({withList:e,fields:n,fieldsFlat:r,where:s,having:i,table:a,joins:l,orderBy:c,groupBy:u,limit:d,offset:h,lockingClause:p,distinct:f,setOperators:m}){const v=r??He(n);for(const e of v)if(t(e.field,o)&&y(e.field.table)!==(t(a,ie)?a[se].alias:t(a,rt)?a[le].name:t(a,de)?void 0:y(a))&&!(e=>l?.some((({alias:t})=>t===(e[g.Symbol.IsAlias]?y(e):e[g.Symbol.BaseName]))))(e.field.table)){const t=y(e.field.table);throw new Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}const b=!l||0===l.length;let w,S;if(e?.length){const t=[ge`with `];for(const[n,r]of e.entries())t.push(ge`${ge.identifier(r[se].alias)} as (${r[se].sql})`),n<e.length-1&&t.push(ge`, `);t.push(ge` `),w=ge.join(t)}f&&(S=!0===f?ge` distinct`:ge` distinct on (${ge.join(f.on,ge`, `)})`);const x=this.buildSelection(v,{isSingleTable:b}),N=(()=>{if(t(a,g)&&a[g.Symbol.OriginalName]!==a[g.Symbol.Name]){let e=ge`${ge.identifier(a[g.Symbol.OriginalName])}`;return a[g.Symbol.Schema]&&(e=ge`${ge.identifier(a[g.Symbol.Schema])}.${e}`),ge`${e} ${ge.identifier(a[g.Symbol.Name])}`}return a})(),T=[];if(l)for(const[e,n]of l.entries()){0===e&&T.push(ge` `);const r=n.table,s=n.lateral?ge` lateral`:void 0;if(t(r,_)){const e=r[_.Symbol.Name],t=r[_.Symbol.Schema],i=r[_.Symbol.OriginalName],a=e===i?void 0:n.alias;T.push(ge`${ge.raw(n.joinType)} join${s} ${t?ge`${ge.identifier(t)}.`:void 0}${ge.identifier(i)}${a&&ge` ${ge.identifier(a)}`} on ${n.on}`)}else if(t(r,be)){const e=r[le].name,t=r[le].schema,i=r[le].originalName,a=e===i?void 0:n.alias;T.push(ge`${ge.raw(n.joinType)} join${s} ${t?ge`${ge.identifier(t)}.`:void 0}${ge.identifier(i)}${a&&ge` ${ge.identifier(a)}`} on ${n.on}`)}else T.push(ge`${ge.raw(n.joinType)} join${s} ${r} on ${n.on}`);e<l.length-1&&T.push(ge` `)}const O=ge.join(T),k=s?ge` where ${s}`:void 0,E=i?ge` having ${i}`:void 0;let $,j;c&&c.length>0&&($=ge` order by ${ge.join(c,ge`, `)}`),u&&u.length>0&&(j=ge` group by ${ge.join(u,ge`, `)}`);const P=d?ge` limit ${d}`:void 0,A=h?ge` offset ${h}`:void 0,C=ge.empty();if(p){const e=ge` for ${ge.raw(p.strength)}`;p.config.of&&e.append(ge` of ${ge.join(Array.isArray(p.config.of)?p.config.of:[p.config.of],ge`, `)}`),p.config.noWait?e.append(ge` no wait`):p.config.skipLocked&&e.append(ge` skip locked`),C.append(e)}const I=ge`${w}select${S} ${x} from ${N}${O}${k}${j}${E}${$}${P}${A}${C}`;return m.length>0?this.buildSetOperations(I,m):I}buildSetOperations(e,t){const[n,...r]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return 0===r.length?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),r)}buildSetOperationQuery({leftSelect:e,setOperator:{type:n,isAll:r,rightSelect:s,limit:i,orderBy:a,offset:o}}){const l=ge`(${e.getSQL()}) `,c=ge`(${s.getSQL()})`;let u;if(a&&a.length>0){const e=[];for(const n of a)if(t(n,ze))e.push(ge.identifier(n.name));else if(t(n,de)){for(let e=0;e<n.queryChunks.length;e++){const r=n.queryChunks[e];t(r,ze)&&(n.queryChunks[e]=ge.identifier(r.name))}e.push(ge`${n}`)}else e.push(ge`${n}`);u=ge` order by ${ge.join(e,ge`, `)} `}const d=i?ge` limit ${i}`:void 0,h=ge.raw(`${n} ${r?"all ":""}`);return ge`${l}${h}${c}${u}${d}${o?ge` offset ${o}`:void 0}`}buildInsertQuery({table:e,values:n,onConflict:r,returning:s}){const i=[],a=e[g.Symbol.Columns],o=Object.entries(a),l=o.map((([,e])=>ge.identifier(e.name)));for(const[e,r]of n.entries()){const s=[];for(const[e,n]of o){const i=r[e];if(void 0===i||t(i,me)&&void 0===i.value)if(void 0!==n.defaultFn){const e=n.defaultFn(),r=t(e,de)?e:ge.param(e,n);s.push(r)}else s.push(ge`default`);else s.push(i)}i.push(s),e<n.length-1&&i.push(ge`, `)}const c=ge.join(i);return ge`insert into ${e} ${l} values ${c}${r?ge` on conflict ${r}`:void 0}${s?ge` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:n}){return ge`refresh materialized view${t?ge` concurrently`:void 0} ${e}${n?ge` with no data`:void 0}`}prepareTyping(e){return t(e,Re)||t(e,Ze)?"json":t(e,Me)?"decimal":t(e,Ue)?"time":t(e,Ve)?"timestamp":t(e,We)?"date":t(e,Ye)?"uuid":"none"}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}buildRelationalQueryWithoutPK({fullSchema:e,schema:n,tableNamesMap:r,table:s,tableConfig:i,queryConfig:a,tableAlias:l,nestedQueryRelation:c,joinOn:u}){let d,h,p,f=[],m=[];const y=[];if(!0===a)f=Object.entries(i.columns).map((([e,t])=>({dbKey:t.name,tsKey:e,field:Ne(t,l),relationTableTsKey:void 0,isJson:!1,selection:[]})));else{const s=Object.fromEntries(Object.entries(i.columns).map((([e,t])=>[e,Ne(t,l)])));if(a.where){const e="function"==typeof a.where?a.where(s,{and:k,between:R,eq:T,exists:L,gt:j,gte:P,ilike:Q,inArray:I,isNull:D,isNotNull:z,like:M,lt:A,lte:C,ne:O,not:$,notBetween:Z,notExists:B,notLike:U,notIlike:F,notInArray:q,or:E,sql:ge}):a.where;p=e&&Oe(e,l)}const c=[];let u=[];if(a.columns){let e=!1;for(const[t,n]of Object.entries(a.columns))void 0!==n&&t in i.columns&&(e||!0!==n||(e=!0),u.push(t));u.length>0&&(u=e?u.filter((e=>!0===a.columns?.[e])):Object.keys(i.columns).filter((e=>!u.includes(e))))}else u=Object.keys(i.columns);for(const e of u){const t=i.columns[e];c.push({tsKey:e,value:t})}let v,_=[];if(a.with&&(_=Object.entries(a.with).filter((e=>!!e[1])).map((([e,t])=>({tsKey:e,queryConfig:t,relation:i.relations[e]})))),a.extras){v="function"==typeof a.extras?a.extras(s,{sql:ge}):a.extras;for(const[e,t]of Object.entries(v))c.push({tsKey:e,value:Te(t,l)})}for(const{tsKey:e,value:n}of c)f.push({dbKey:t(n,de.Aliased)?n.fieldAlias:i.columns[e].name,tsKey:e,field:t(n,o)?Ne(n,l):n,relationTableTsKey:void 0,isJson:!1,selection:[]});let b="function"==typeof a.orderBy?a.orderBy(s,{sql:ge,asc:V,desc:K}):a.orderBy??[];Array.isArray(b)||(b=[b]),m=b.map((e=>t(e,o)?Ne(e,l):Oe(e,l))),d=a.limit,h=a.offset;for(const{tsKey:s,queryConfig:i,relation:a}of _){const o=te(n,r,a),c=r[a.referencedTable[g.Symbol.Name]],u=`${l}_${s}`,d=k(...o.fields.map(((e,t)=>T(Ne(o.references[t],u),Ne(e,l))))),h=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:n,tableNamesMap:r,table:e[c],tableConfig:n[c],queryConfig:t(a,W)?!0===i?{limit:1}:{...i,limit:1}:i,tableAlias:u,joinOn:d,nestedQueryRelation:a}),p=ge`${ge.identifier(u)}.${ge.identifier("data")}`.as(s);y.push({on:ge`true`,table:new ie(h.sql,{},u),alias:u,joinType:"left",lateral:!0}),f.push({dbKey:s,tsKey:s,field:p,relationTableTsKey:c,isJson:!0,selection:h.selection})}}if(0===f.length)throw new ke({message:`No fields selected for table "${i.tsName}" ("${l}")`});let v;if(p=k(u,p),c){let e=ge`json_build_array(${ge.join(f.map((({field:e,tsKey:n,isJson:r})=>r?ge`${ge.identifier(`${l}_${n}`)}.${ge.identifier("data")}`:t(e,de.Aliased)?e.sql:e)),ge`, `)})`;t(c,Y)&&(e=ge`coalesce(json_agg(${e}${m.length>0?ge` order by ${ge.join(m,ge`, `)}`:void 0}), '[]'::json)`);const n=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:f}];void 0!==d||void 0!==h||m.length>0?(v=this.buildSelectQuery({table:xe(s,l),fields:{},fieldsFlat:[{path:[],field:ge.raw("*")}],where:p,limit:d,offset:h,orderBy:m,setOperators:[]}),p=void 0,d=void 0,h=void 0,m=[]):v=xe(s,l),v=this.buildSelectQuery({table:t(v,_)?v:new ie(v,{},l),fields:{},fieldsFlat:n.map((({field:e})=>({path:[],field:t(e,o)?Ne(e,l):e}))),joins:y,where:p,limit:d,offset:h,orderBy:m,setOperators:[]})}else v=this.buildSelectQuery({table:xe(s,l),fields:{},fieldsFlat:f.map((({field:e})=>({path:[],field:t(e,o)?Ne(e,l):e}))),joins:y,where:p,limit:d,offset:h,orderBy:m,setOperators:[]});return{tableTsKey:i.tsName,sql:v,selection:f}}}class it{static[e]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class at{static[e]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then((t=>(e?.(),t)),(t=>{throw e?.(),t}))}then(e,t){return this.execute().then(e,t)}}class ot{static[e]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,n){if(n===se)return{...e[se],selection:new Proxy(e[se].selection,this)};if(n===le)return{...e[le],selectedFields:new Proxy(e[le].selectedFields,this)};if("symbol"==typeof n)return e[n];const r=(t(e,ie)?e[se].selection:t(e,be)?e[le].selectedFields:e)[n];if(t(r,de.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!r.isSelectionField)return r.sql;const e=r.clone();return e.isSelectionField=!0,e}if(t(r,de)){if("sql"===this.config.sqlBehavior)return r;throw new Error(`You tried to reference "${n}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return t(r,o)?this.config.alias?new Proxy(r,new we(new Proxy(r.table,new Se(this.config.alias,this.config.replaceOriginalName??!1)))):r:"object"!=typeof r||null===r?r:new Proxy(r,new ot(this.config))}}class lt{static[e]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){const n=!!this.fields;let r;return r=this.fields?this.fields:t(e,ie)?Object.fromEntries(Object.keys(e[se].selection).map((t=>[t,e[t]]))):t(e,rt)?e[le].selectedFields:t(e,de)?{}:tt(e),new ut({table:e,fields:r,isPartialSelect:n,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class ct extends it{static[e]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:n,session:r,dialect:s,withList:i,distinct:a}){super(),this.config={withList:i,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=n,this.session=r,this.dialect=s,this._={selectedFields:t},this.tableName=nt(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(n,r)=>{const s=this.tableName,i=nt(n);if("string"==typeof i&&this.config.joins?.some((e=>e.alias===i)))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof s&&(this.config.fields={[s]:this.config.fields}),"string"==typeof i&&!t(n,de))){const e=t(n,ie)?n[se].selection:t(n,be)?n[le].selectedFields:n[g.Symbol.Columns];this.config.fields[i]=e}if("function"==typeof r&&(r=r(new Proxy(this.config.fields,new ot({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:n,joinType:e,alias:i}),"string"==typeof i)switch(e){case"left":this.joinsNotNullableMap[i]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[i]=!0;break;case"inner":this.joinsNotNullableMap[i]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[i]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return n=>{const r="function"==typeof n?n(ht()):n;if(!Xe(this.getSelectedFields(),r.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:r}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ot({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ot({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new ot({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new ot({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{const t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new ie(this.getSQL(),this.config.fields,e),new ot({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ot({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class ut extends ct{static[e]="PgSelect";_prepare(e){const{session:t,config:n,dialect:r,joinsNotNullableMap:s}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return oe("drizzle.prepareQuery",(()=>{const i=He(n.fields),a=t.prepareQuery(r.sqlToQuery(this.getSQL()),i,e);return a.joinsNotNullableMap=s,a}))}prepare(e){return this._prepare(e)}execute=e=>oe("drizzle.operation",(()=>this._prepare().execute(e)))}function dt(e,t){return(n,r,...s)=>{const i=[r,...s].map((n=>({type:e,isAll:t,rightSelect:n})));for(const e of i)if(!Xe(n.getSelectedFields(),e.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return n.addSetOperators(i)}}!function(e,t){for(const n of t)for(const t of Object.getOwnPropertyNames(n.prototype))"constructor"!==t&&Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(n.prototype,t)||Object.create(null))}(ut,[at]);const ht=()=>({union:pt,unionAll:ft,intersect:mt,intersectAll:gt,except:yt,exceptAll:vt}),pt=dt("union",!1),ft=dt("union",!0),mt=dt("intersect",!1),gt=dt("intersect",!0),yt=dt("except",!1),vt=dt("except",!0);class _t{static[e]="PgQueryBuilder";dialect;$with(e){const t=this;return{as:n=>("function"==typeof n&&(n=n(t)),new Proxy(new ae(n.getSQL(),n.getSelectedFields(),e,!0),new ot({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(n){return new lt({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(e){return new lt({fields:e??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})},selectDistinctOn:function(e,n){return new lt({fields:n??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:e}})}}}select(e){return new lt({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new lt({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new lt({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new st),this.dialect}}class bt{constructor(e,t,n){this.table=e,this.session=t,this.dialect=n}static[e]="PgUpdateBuilder";set(e){return new wt(this.table,et(this.table,e),this.session,this.dialect)}}class wt extends at{constructor(e,t,n,r){super(),this.session=n,this.dialect=r,this.config={set:t,table:e}}static[e]="PgUpdate";config;where(e){return this.config.where=e,this}returning(e=this.config.table[g.Symbol.Columns]){return this.config.returning=He(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}execute=e=>this._prepare().execute(e);$dynamic(){return this}}class St{constructor(e,t,n){this.table=e,this.session=t,this.dialect=n}static[e]="PgInsertBuilder";values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw new Error("values() must be called with at least one value");const n=e.map((e=>{const n={},r=this.table[g.Symbol.Columns];for(const s of Object.keys(e)){const i=e[s];n[s]=t(i,de)?i:new me(i,r[s])}return n}));return new xt(this.table,n,this.session,this.dialect)}}class xt extends at{constructor(e,t,n,r){super(),this.session=n,this.dialect=r,this.config={table:e,values:t}}static[e]="PgInsert";config;returning(e=this.config.table[g.Symbol.Columns]){return this.config.returning=He(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=ge`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name);const n=e.where?ge` where ${e.where}`:void 0;this.config.onConflict=ge`(${ge.raw(t)}) do nothing${n}`}return this}onConflictDoUpdate(e){const t=e.where?ge` where ${e.where}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,et(this.config.table,e.set));let r="";return r=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name),this.config.onConflict=ge`(${ge.raw(r)}) do update set ${n}${t}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return oe("drizzle.prepareQuery",(()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)))}prepare(e){return this._prepare(e)}execute=e=>oe("drizzle.operation",(()=>this._prepare().execute(e)));$dynamic(){return this}}class Nt extends at{constructor(e,t,n){super(),this.session=t,this.dialect=n,this.config={table:e}}static[e]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[g.Symbol.Columns]){return this.config.returning=He(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return oe("drizzle.prepareQuery",(()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)))}prepare(e){return this._prepare(e)}execute=e=>oe("drizzle.operation",(()=>this._prepare().execute(e)));$dynamic(){return this}}class Tt{constructor(e,t,n,r,s,i,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=r,this.tableConfig=s,this.dialect=i,this.session=a}static[e]="PgRelationalQueryBuilder";findMany(e){return new Ot(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Ot(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class Ot extends at{constructor(e,t,n,r,s,i,a,o,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=r,this.tableConfig=s,this.dialect=i,this.session=a,this.config=o,this.mode=l}static[e]="PgRelationalQuery";_prepare(e){return oe("drizzle.prepareQuery",(()=>{const{query:t,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,((e,n)=>{const r=e.map((e=>re(this.schema,this.tableConfig,e,t.selection,n)));return"first"===this.mode?r[0]:r}))}))}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){const e=this._getQuery();return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}execute(){return oe("drizzle.operation",(()=>this._prepare().execute()))}}class kt extends at{constructor(e,t,n){super(),this.session=t,this.dialect=n,this.config={view:e}}static[e]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return oe("drizzle.prepareQuery",(()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e)))}prepare(e){return this._prepare(e)}execute=e=>oe("drizzle.operation",(()=>this._prepare().execute(e)))}class Et{constructor(e,t,n){if(this.dialect=e,this.session=t,this._=n?{schema:n.schema,tableNamesMap:n.tableNamesMap}:{schema:void 0,tableNamesMap:{}},this.query={},this._.schema)for(const[r,s]of Object.entries(this._.schema))this.query[r]=new Tt(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[r],s,e,t)}static[e]="PgDatabase";query;$with(e){return{as:t=>("function"==typeof t&&(t=t(new _t)),new Proxy(new ae(t.getSQL(),t.getSelectedFields(),e,!0),new ot({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(n){return new lt({fields:n??void 0,session:t.session,dialect:t.dialect,withList:e})}}}select(e){return new lt({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new lt({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new lt({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new bt(e,this.session,this.dialect)}insert(e){return new St(e,this.session,this.dialect)}delete(e){return new Nt(e,this.session,this.dialect)}refreshMaterializedView(e){return new kt(e,this.session,this.dialect)}execute(e){return this.session.execute(e.getSQL())}transaction(e,t){return this.session.transaction(e,t)}}class $t{static[e]="PgPreparedQuery";joinsNotNullableMap}class jt{constructor(e){this.dialect=e}static[e]="PgSession";execute(e){return oe("drizzle.operation",(()=>oe("drizzle.prepareQuery",(()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0))).execute()))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0).all()}}class Pt extends Et{constructor(e,t,n,r=0){super(e,t,n),this.schema=n,this.nestedIndex=r}static[e]="PgTransaction";rollback(){throw new Ee}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),ge.raw(t.join(" "))}setTransaction(e){return this.session.execute(ge`set transaction ${this.getTransactionConfigSQL(e)}`)}}class At extends $t{constructor(e,t,n,r,s,i){super(),this.client=e,this.query=t,this.params=n,this.logger=r,this.fields=s,this.customResultMapper=i}static[e]="PostgresJsPreparedQuery";async execute(e={}){return oe("drizzle.execute",(async n=>{const r=_e(this.params,e);n?.setAttributes({"drizzle.query.text":this.query,"drizzle.query.params":JSON.stringify(r)}),this.logger.logQuery(this.query,r);const{fields:s,query:i,client:a,joinsNotNullableMap:l,customResultMapper:c}=this;if(!s&&!c)return oe("drizzle.driver.execute",(()=>a.unsafe(i,r)));const u=await oe("drizzle.driver.execute",(()=>(n?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(r)}),a.unsafe(i,r).values())));return oe("drizzle.mapResponse",(()=>c?c(u):u.map((e=>function(e,n,r){const s={},i=e.reduce(((e,{path:i,field:a},l)=>{let c;c=t(a,o)?a:t(a,de)?a.decoder:a.sql.decoder;let u=e;for(const[e,d]of i.entries())if(e<i.length-1)d in u||(u[d]={}),u=u[d];else{const e=n[l],h=u[d]=null===e?null:c.mapFromDriverValue(e);if(r&&t(a,o)&&2===i.length){const e=i[0];e in s?"string"==typeof s[e]&&s[e]!==y(a.table)&&(s[e]=!1):s[e]=null===h&&y(a.table)}}return e}),{});if(r&&Object.keys(s).length>0)for(const[e,t]of Object.entries(s))"string"!=typeof t||r[t]||(i[e]=null);return i}(s,e,l)))))}))}all(e={}){return oe("drizzle.execute",(async t=>{const n=_e(this.params,e);return t?.setAttributes({"drizzle.query.text":this.query,"drizzle.query.params":JSON.stringify(n)}),this.logger.logQuery(this.query,n),oe("drizzle.driver.execute",(()=>(t?.setAttributes({"drizzle.query.text":this.query,"drizzle.query.params":JSON.stringify(n)}),this.client.unsafe(this.query,n))))}))}}class Ct extends jt{constructor(e,t,n,r={}){super(t),this.client=e,this.schema=n,this.options=r,this.logger=r.logger??new a}static[e]="PostgresJsSession";logger;prepareQuery(e,t,n,r){return new At(this.client,e.sql,e.params,this.logger,t,r)}query(e,t){return this.logger.logQuery(e,t),this.client.unsafe(e,t).values()}queryObjects(e,t){return this.client.unsafe(e,t)}transaction(e,t){return this.client.begin((async n=>{const r=new Ct(n,this.dialect,this.schema,this.options),s=new It(this.dialect,r,this.schema);return t&&await s.setTransaction(t),e(s)}))}}class It extends Pt{constructor(e,t,n,r=0){super(e,t,n,r),this.session=t}static[e]="PostgresJsTransaction";transaction(e){return this.session.client.savepoint((t=>{const n=new Ct(t,this.dialect,this.schema,this.session.options),r=new It(this.dialect,n,this.schema);return e(r)}))}}var qt=n(37),Dt=n(147);const zt=new Map,Lt=new Map,Bt=Symbol("OriginError"),Rt={};class Zt extends Promise{constructor(e,t,n,r,s={}){let i,a;super(((e,t)=>{i=e,a=t})),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=n,this.canceller=r,this.options=s,this.state=null,this.statement=null,this.resolve=e=>(this.active=!1,i(e)),this.reject=e=>(this.active=!1,a(e)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[Bt]=this.handler.debug?new Error:this.tagged&&function(e){if(zt.has(e))return zt.get(e);const t=Error.stackTraceLimit;return Error.stackTraceLimit=4,zt.set(e,new Error),Error.stackTraceLimit=t,zt.get(e)}(this.strings)}get origin(){return(this.handler.debug?this[Bt].stack:this.tagged&&Lt.has(this.strings)?Lt.get(this.strings):Lt.set(this.strings,this[Bt].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){if(this.options.simple=!1,"function"==typeof e&&(t=e,e=1),this.cursorRows=e,"function"==typeof t)return this.cursorFn=t,this;let n;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};n&&n();const e=new Promise(((e,t)=>{this.cursorFn=t=>(e({value:t,done:!1}),new Promise((e=>n=e))),this.resolve=()=>(this.active=!1,e({done:!0})),this.reject=e=>(this.active=!1,t(e))}));return this.execute(),e},return:()=>(n&&n(Rt),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class Mt extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}}const Ut={connection:function e(t,n,r){const{host:s,port:i}=r||n,a=Object.assign(new Error("write "+t+" "+(n.path||s+":"+i)),{code:t,errno:t,address:n.path||s},n.path?{}:{port:i});return Error.captureStackTrace(a,e),a},postgres:function e(t){const n=new Mt(t);return Error.captureStackTrace(n,e),n},generic:function e(t,n){const r=Object.assign(new Error(t+": "+n),{code:t});return Error.captureStackTrace(r,e),r},notSupported:function e(t){const n=Object.assign(new Error(t+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:t});return Error.captureStackTrace(n,e),n}},Qt={string:{to:25,from:null,serialize:e=>""+e},number:{to:0,from:[21,23,26,700,701],serialize:e=>""+e,parse:e=>+e},json:{to:114,from:[114,3802],serialize:e=>JSON.stringify(e),parse:e=>JSON.parse(e)},boolean:{to:16,from:16,serialize:e=>!0===e?"t":"f",parse:e=>"t"===e},date:{to:1184,from:[1082,1114,1184],serialize:e=>(e instanceof Date?e:new Date(e)).toISOString(),parse:e=>new Date(e)},bytea:{to:17,from:17,serialize:e=>"\\x"+Buffer.from(e).toString("hex"),parse:e=>Buffer.from(e.slice(2),"hex")}};class Ft{then(){sn()}catch(){sn()}finally(){sn()}}class Vt extends Ft{constructor(e){super(),this.value=hn(e)}}class Kt extends Ft{constructor(e,t,n){super(),this.value=e,this.type=t,this.array=n}}class Gt extends Ft{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,n,r){const s=rn.map((([t,n])=>({fn:n,i:e.search(t)}))).sort(((e,t)=>e.i-t.i)).pop();return-1===s.i?dn(this.first,r):s.fn(this.first,this.rest,t,n,r)}}function Jt(e,t,n,r){let s=e instanceof Kt?e.value:e;if(void 0===s&&(e instanceof Kt?e.value=r.transform.undefined:s=e=r.transform.undefined,void 0===s))throw Ut.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+n.push(e instanceof Kt?(t.push(e.value),e.array?e.array[e.type||pn(e.value)]||e.type||ln(e.value):e.type):(t.push(e),pn(e)))}const Wt=un(Qt);function Yt(e,t,n,r,s,i){for(let a=1;a<e.strings.length;a++)t+=Ht(t,n,r,s,i)+e.strings[a],n=e.args[a];return t}function Ht(e,t,n,r,s){return t instanceof Gt?t.build(e,n,r,s):t instanceof Zt?Xt(t,n,r,s):t instanceof Vt?t.value:t&&t[0]instanceof Zt?t.reduce(((e,t)=>e+" "+Xt(t,n,r,s)),""):Jt(t,n,r,s)}function Xt(e,t,n,r){return e.fragment=!0,Yt(e,e.strings[0],e.args[0],t,n,r)}function en(e,t,n,r,s){return e.map((e=>"("+r.map((r=>Ht("values",e[r],t,n,s))).join(",")+")")).join(",")}function tn(e,t,n,r,s){const i=Array.isArray(e[0]);return en(i?e:[e],n,r,t.length?t.flat():Object.keys(i?e[0]:e),s)}function nn(e,t,n,r,s){if("string"==typeof e&&(e=[e].concat(t)),Array.isArray(e))return dn(e,s);let i;return(t.length?t.flat():Object.keys(e)).map((t=>(i=e[t],(i instanceof Zt?Xt(i,n,r,s):i instanceof Vt?i.value:Jt(i,n,r,s))+" as "+hn(s.transform.column.to?s.transform.column.to(t):t)))).join(",")}const rn=Object.entries({values:tn,in:(...e)=>{const t=tn(...e);return"()"===t?"(null)":t},select:nn,as:nn,returning:nn,"\\(":nn,update:(e,t,n,r,s)=>(t.length?t.flat():Object.keys(e)).map((t=>hn(s.transform.column.to?s.transform.column.to(t):t)+"="+Ht("values",e[t],n,r,s))),insert(e,t,n,r,s){const i=t.length?t.flat():Object.keys(Array.isArray(e)?e[0]:e);return"("+dn(i,s)+")values"+en(Array.isArray(e)?e:[e],n,r,i,s)}}).map((([e,t])=>[new RegExp("((?:^|[\\s(])"+e+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),t]));function sn(){throw Ut.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}const an=Wt.serializers,on=Wt.parsers;function ln(e){return Array.isArray(e)?ln(e[0]):"string"==typeof e?1009:0}const cn=function(e){const t=un(e||{});return{serializers:Object.assign({},an,t.serializers),parsers:Object.assign({},on,t.parsers)}};function un(e){return Object.keys(e).reduce(((t,n)=>(e[n].from&&[].concat(e[n].from).forEach((r=>t.parsers[r]=e[n].parse)),e[n].serialize&&(t.serializers[e[n].to]=e[n].serialize,e[n].from&&[].concat(e[n].from).forEach((r=>t.serializers[r]=e[n].serialize))),t)),{parsers:{},serializers:{}})}function dn(e,{transform:{column:t}}){return e.map((e=>hn(t.to?t.to(e):e))).join(",")}const hn=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},pn=function e(t){return t instanceof Kt?t.type:t instanceof Date?1184:t instanceof Uint8Array?17:!0===t||!1===t?16:"bigint"==typeof t?20:Array.isArray(t)?e(t[0]):0},fn=/\\/g,mn=/"/g,gn=function e(t,n,r,s){if(!1===Array.isArray(t))return t;if(!t.length)return"{}";const i=t[0],a=1020===s?";":",";return Array.isArray(i)&&!i.type?"{"+t.map((t=>e(t,n,r,s))).join(a)+"}":"{"+t.map((e=>{if(void 0===e&&void 0===(e=r.transform.undefined))throw Ut.generic("UNDEFINED_VALUE","Undefined values are not allowed");return null===e?"null":'"'+function(e){return e.replace(fn,"\\\\").replace(mn,'\\"')}(n?n(e.type?e.value:e):""+e)+'"'})).join(a)+"}"},yn={i:0,char:null,str:"",quoted:!1,last:0},vn=function(e,t,n){return yn.i=yn.last=0,_n(yn,e,t,n)};function _n(e,t,n,r){const s=[],i=1020===r?";":",";for(;e.i<t.length;e.i++){if(e.char=t[e.i],e.quoted)"\\"===e.char?e.str+=t[++e.i]:'"'===e.char?(s.push(n?n(e.str):e.str),e.str="",e.quoted='"'===t[e.i+1],e.last=e.i+2):e.str+=e.char;else if('"'===e.char)e.quoted=!0;else if("{"===e.char)e.last=++e.i,s.push(_n(e,t,n,r));else{if("}"===e.char){e.quoted=!1,e.last<e.i&&s.push(n?n(t.slice(e.last,e.i)):t.slice(e.last,e.i)),e.last=e.i+1;break}e.char===i&&"}"!==e.p&&'"'!==e.p&&(s.push(n?n(t.slice(e.last,e.i)):t.slice(e.last,e.i)),e.last=e.i+1)}e.p=e.char}return e.last<e.i&&s.push(n?n(t.slice(e.last,e.i+1)):t.slice(e.last,e.i+1)),s}const bn=e=>{let t=e[0];for(let n=1;n<e.length;n++)t+="_"===e[n]?e[++n].toUpperCase():e[n];return t},wn=e=>{let t=e[0].toUpperCase();for(let n=1;n<e.length;n++)t+="_"===e[n]?e[++n].toUpperCase():e[n];return t},Sn=e=>e.replace(/_/g,"-"),xn=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),Nn=e=>(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),Tn=e=>e.replace(/-/g,"_");function On(e){return function t(n,r){return"object"!=typeof n||null===n||114!==r.type&&3802!==r.type?n:Array.isArray(n)?n.map((e=>t(e,r))):Object.entries(n).reduce(((n,[s,i])=>Object.assign(n,{[e(s)]:t(i,r)})),{})}}bn.column={from:bn},bn.value={from:On(bn)},xn.column={to:xn};const kn={...bn};kn.column.to=xn,wn.column={from:wn},wn.value={from:On(wn)},Nn.column={to:Nn};const En={...wn};En.column.to=Nn,Sn.column={from:Sn},Sn.value={from:On(Sn)},Tn.column={to:Tn};const $n={...Sn};$n.column.to=Tn;const jn=require("net"),Pn=require("tls");var An=n(113);const Cn=require("stream"),In=require("perf_hooks");class qn extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}const Dn=function(e=[]){let t=e.slice(),n=0;return{get length(){return t.length-n},remove:e=>{const n=t.indexOf(e);return-1===n?null:(t.splice(n,1),e)},push:e=>(t.push(e),e),shift:()=>{const e=t[n++];return n===t.length?(n=0,t=[]):t[n-1]=void 0,e}}};let zn=Buffer.allocUnsafe(256);const Ln="BCcDdEFfHPpQSX".split("").reduce(((e,t)=>{const n=t.charCodeAt(0);return e[t]=()=>(zn[0]=n,Bn.i=5,Bn),e}),{}),Bn=Object.assign((function(){return Bn.i=0,Bn}),Ln,{N:String.fromCharCode(0),i:0,inc:e=>(Bn.i+=e,Bn),str(e){const t=Buffer.byteLength(e);return Zn(t),Bn.i+=zn.write(e,Bn.i,t,"utf8"),Bn},i16:e=>(Zn(2),zn.writeUInt16BE(e,Bn.i),Bn.i+=2,Bn),i32:(e,t)=>t||0===t?(zn.writeUInt32BE(e,t),Bn):(Zn(4),zn.writeUInt32BE(e,Bn.i),Bn.i+=4,Bn),z:e=>(Zn(e),zn.fill(0,Bn.i,Bn.i+e),Bn.i+=e,Bn),raw:e=>(zn=Buffer.concat([zn.subarray(0,Bn.i),e]),Bn.i=zn.length,Bn),end(e=1){zn.writeUInt32BE(Bn.i-e,e);const t=zn.subarray(0,Bn.i);return Bn.i=0,zn=Buffer.allocUnsafe(256),t}}),Rn=Bn;function Zn(e){if(zn.length-Bn.i<e){const t=zn,n=t.length;zn=Buffer.allocUnsafe(n+(n>>1)+e),t.copy(zn)}}const Mn=function e(t,n={},{onopen:r=Jn,onend:s=Jn,onclose:i=Jn}={}){const{ssl:a,max:o,user:l,host:c,port:u,database:d,parsers:h,transform:p,onnotice:f,onnotify:m,onparameter:g,max_pipeline:y,keep_alive:v,backoff:_,target_session_attrs:b}=t,w=Dn(),S=Un++,x={pid:null,secret:null},N=tr(ye,t.idle_timeout),T=tr(ye,t.max_lifetime),O=tr((function(){me(Ut.connection("CONNECT_TIMEOUT",t,E)),E.destroy()}),t.connect_timeout);let k,E=null,$=new qn,j=Buffer.alloc(0),P=t.fetch_types,A={},C={},I=Math.random().toString(36).slice(2),q=1,D=0,z=0,L=0,B=0,R=0,Z=0,M=0,U=null,Q=null,F=!1,V=null,K=null,G=null,J=null,W=null,Y=null,H=null,X=null,ee=null,te=null;const ne={queue:n.closed,idleTimer:N,connect(e){G=e||!0,he()},terminate:ve,execute:re,cancel:async function({pid:e,secret:t},n,r){try{k=Rn().i32(16).i32(80877102).i32(e).i32(t).end(16),await de(),E.once("error",r),E.once("close",n)}catch(e){r(e)}},end:ye,count:0,id:S};return n.closed&&n.closed.push(ne),ne;function re(e){if(F)return ge(e,Ut.connection("CONNECTION_DESTROYED",t));if(!e.cancelled)try{return e.state=x,ee?w.push(e):(ee=e,ee.active=!0),function(e){const n=[],r=[],s=Yt(e,e.strings[0],e.args[0],n,r,t);!e.tagged&&e.args.forEach((e=>Jt(e,n,r,t))),e.prepare=t.prepare&&(!("prepare"in e.options)||e.options.prepare),e.string=s,e.signature=e.prepare&&r+s,e.onlyDescribe&&delete C[e.signature],e.parameters=e.parameters||n,e.prepared=e.prepare&&e.signature in C,e.describeFirst=e.onlyDescribe||n.length&&!e.prepared,e.statement=e.prepared?C[e.signature]:{string:s,types:r,name:e.prepare?I+q++:""},"function"==typeof t.debug&&t.debug(S,s,n,r)}(e),ae(function(e){if(e.parameters.length>=65534)throw Ut.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return e.options.simple?Rn().Q().str(e.statement.string+Rn.N).end():e.describeFirst?Buffer.concat([se(e),Fn]):e.prepare?e.prepared?ie(e):Buffer.concat([se(e),ie(e)]):function(e){return Buffer.concat([et(e.statement.string,e.parameters,e.statement.types),Gn,ie(e)])}(e)}(e))&&!e.describeFirst&&!e.cursorFn&&w.length<y&&(!e.options.onexecute||e.options.onexecute(ne))}catch(e){return 0===w.length&&ae(Qn),me(e),!0}}function se(e){return Buffer.concat([et(e.statement.string,e.parameters,e.statement.types,e.statement.name),tt("S",e.statement.name)])}function ie(e){return Buffer.concat([Xe(e.parameters,e.statement.types,e.statement.name,e.cursorName),e.cursorFn?nt("",e.cursorRows):Kn])}function ae(e,t){return Y=Y?Buffer.concat([Y,e]):Buffer.from(e),t||Y.length>=1024?oe(t):(null===Q&&(Q=setImmediate(oe)),!0)}function oe(e){const t=E.write(Y,e);return null!==Q&&clearImmediate(Q),Y=Q=null,t}async function le(){if(ae(Vn),!await new Promise((e=>E.once("data",(t=>e(83===t[0])))))&&"prefer"===a)return pe();E.removeAllListeners(),E=Pn.connect({socket:E,servername:jn.isIP(E.host)?void 0:E.host,..."require"===a||"allow"===a||"prefer"===a?{rejectUnauthorized:!1}:"verify-full"===a?{}:"object"==typeof a?a:{}}),E.on("secureConnect",pe),E.on("error",fe),E.on("close",_e),E.on("drain",ce)}function ce(){!ee&&r(ne)}function ue(e){if(!(V&&(V.push(e),z-=e.length,z>=0)))for(j=V?Buffer.concat(V,R-z):0===j.length?e:Buffer.concat([j,e],j.length+e.length);j.length>4;){if(R=j.readUInt32BE(1),R>=j.length){z=R-j.length,V=[j];break}try{be(j.subarray(0,R+1))}catch(e){ee&&(ee.cursorFn||ee.describeFirst)&&ae(Qn),me(e)}j=j.subarray(R+1),z=0,V=null}}async function de(){if(F=!1,A={},E||(E=await async function(){let e;try{e=t.socket?await Promise.resolve(t.socket(t)):new jn.Socket}catch(e){return void fe(e)}return e.on("error",fe),e.on("close",_e),e.on("drain",ce),e}()),E){if(O.start(),t.socket)return a?le():pe();if(E.on("connect",a?le:pe),t.path)return E.connect(t.path);E.ssl=a,E.connect(u[L],c[L]),E.host=c[L],E.port=u[L],L=(L+1)%u.length}}function he(){setTimeout(de,D?D+Z-In.performance.now():0)}function pe(){try{C={},P=t.fetch_types,I=Math.random().toString(36).slice(2),q=1,T.start(),E.on("data",ue),v&&E.setKeepAlive&&E.setKeepAlive(!0,1e3*v),ae(k||Rn().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:l,database:d,client_encoding:"UTF8"},t.connection)).filter((([,e])=>e)).map((([e,t])=>e+Rn.N+t)).join(Rn.N)).z(2).end(0))}catch(e){fe(e)}}function fe(e){if(ne.queue!==n.connecting||!t.host[B+1])for(me(e);w.length;)ge(w.shift(),e)}function me(e){W&&(W.destroy(e),W=null),ee&&ge(ee,e),G&&(ge(G,e),G=null)}function ge(e,n){Object.defineProperties(n,{stack:{value:n.stack+e.origin.replace(/.*\n/,"\n"),enumerable:t.debug},query:{value:e.string,enumerable:t.debug},parameters:{value:e.parameters,enumerable:t.debug},args:{value:e.args,enumerable:t.debug},types:{value:e.statement&&e.statement.types,enumerable:t.debug}}),e.reject(n)}function ye(){return J||(!ne.reserved&&s(ne),ne.reserved||G||ee||0!==w.length?J=new Promise((e=>H=e)):(ve(),new Promise((e=>E&&"closed"!==E.readyState?E.once("close",e):e()))))}function ve(){F=!0,(W||ee||G||w.length)&&fe(Ut.connection("CONNECTION_DESTROYED",t)),clearImmediate(Q),E&&(E.removeListener("data",ue),E.removeListener("connect",pe),"open"===E.readyState&&E.end(Rn().X().end())),H&&(H(),J=H=null)}async function _e(e){if(j=Buffer.alloc(0),z=0,V=null,clearImmediate(Q),E.removeListener("data",ue),E.removeListener("connect",pe),N.cancel(),T.cancel(),O.cancel(),E.encrypted&&(E.removeAllListeners(),E=null),G)return he();!e&&(ee||w.length)&&fe(Ut.connection("CONNECTION_CLOSED",t,E)),D=In.performance.now(),e&&t.shared.retries++,Z=1e3*("function"==typeof _?_(t.shared.retries):_),i(ne,Ut.connection("CONNECTION_CLOSED",t,E))}function be(e,t=e[0]){(68===t?we:100===t?Fe:65===t?Be:83===t?Se:90===t?xe:67===t?Ne:50===t?Oe:49===t?Te:116===t?ke:84===t?Ee:82===t?$e:110===t?De:75===t?ze:69===t?Le:115===t?Re:51===t?Ze:71===t?Me:78===t?Ke:72===t?Ue:99===t?Ve:73===t?Ge:86===t?Je:118===t?We:87===t?Qe:Ye)(e)}function we(e){let t,n,r,s=7;const i=ee.isRaw?new Array(ee.statement.columns.length):{};for(let a=0;a<ee.statement.columns.length;a++)n=ee.statement.columns[a],t=e.readInt32BE(s),s+=4,r=-1===t?null:!0===ee.isRaw?e.subarray(s,s+=t):void 0===n.parser?e.toString("utf8",s,s+=t):!0===n.parser.array?n.parser(e.toString("utf8",s+1,s+=t)):n.parser(e.toString("utf8",s,s+=t)),ee.isRaw?i[a]=!0===ee.isRaw?r:p.value.from?p.value.from(r,n):r:i[n.name]=p.value.from?p.value.from(r,n):r;ee.forEachFn?ee.forEachFn(p.row.from?p.row.from(i):i,$):$[M++]=p.row.from?p.row.from(i):i}function Se(e){const[n,r]=e.toString("utf8",5,e.length-1).split(Rn.N);A[n]=r,t.parameters[n]!==r&&(t.parameters[n]=r,g&&g(n,r))}function xe(n){if(ee&&ee.options.simple&&ee.resolve(K||$),ee=K=null,$=new qn,O.cancel(),G){if(b){if(!A.in_hot_standby||!A.default_transaction_read_only)return function(){const e=new Zt(["\n      show transaction_read_only;\n      select pg_catalog.pg_is_in_recovery()\n    "],[],re,null,{simple:!0});e.resolve=([[e],[t]])=>{A.default_transaction_read_only=e.transaction_read_only,A.in_hot_standby=t.pg_is_in_recovery?"on":"off"},e.execute()}();if(function(e,n){return"read-write"===e&&"on"===n.default_transaction_read_only||"read-only"===e&&"off"===n.default_transaction_read_only||"primary"===e&&"on"===n.in_hot_standby||"standby"===e&&"off"===n.in_hot_standby||"prefer-standby"===e&&"off"===n.in_hot_standby&&t.host[B]}(b,A))return ve()}return P?(!0===G&&(G=null),async function(){P=!1;(await new Zt(["\n      select b.oid, b.typarray\n      from pg_catalog.pg_type a\n      left join pg_catalog.pg_type b on b.oid = a.typelem\n      where a.typcategory = 'A'\n      group by b.oid, b.typarray\n      order by b.oid\n    "],[],re)).forEach((({oid:e,typarray:n})=>function(e,n){if(t.parsers[n]&&t.serializers[n])return;const r=t.parsers[e];t.shared.typeArrayMap[e]=n,t.parsers[n]=e=>vn(e,r,n),t.parsers[n].array=!0,t.serializers[n]=r=>gn(r,t.serializers[e],t,n)}(e,n)))}()):(!0!==G&&re(G),t.shared.retries=B=0,void(G=null))}for(;w.length&&(ee=w.shift())&&(ee.active=!0,ee.cancelled);)e(t).cancel(ee.state,ee.cancelled.resolve,ee.cancelled.reject);ee||(ne.reserved?ne.reserved.release||73!==n[5]?ne.reserved():J?ve():(ne.reserved=null,r(ne)):J?ve():r(ne))}function Ne(e){M=0;for(let t=e.length-1;t>0;t--)if(32===e[t]&&e[t+1]<58&&null===$.count&&($.count=+e.toString("utf8",t+1,e.length-1)),e[t-1]>=65){$.command=e.toString("utf8",5,t),$.state=x;break}return te&&(te(),te=null),"BEGIN"!==$.command||1===o||ne.reserved?ee.options.simple?Oe():(ee.cursorFn&&($.count&&ee.cursorFn($),ae(Qn)),void ee.resolve($)):me(Ut.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}function Te(){ee.parsing=!1}function Oe(){!$.statement&&($.statement=ee.statement),$.columns=ee.statement.columns}function ke(e){const t=e.readUInt16BE(5);for(let n=0;n<t;++n)!ee.statement.types[n]&&(ee.statement.types[n]=e.readUInt32BE(7+4*n));ee.prepare&&(C[ee.signature]=ee.statement),ee.describeFirst&&!ee.onlyDescribe&&(ae(ie(ee)),ee.describeFirst=!1)}function Ee(e){$.command&&(K=K||[$],K.push($=new qn),$.count=null,ee.statement.columns=null);const t=e.readUInt16BE(5);let n,r=7;ee.statement.columns=Array(t);for(let s=0;s<t;++s){for(n=r;0!==e[r++];);const t=e.readUInt32BE(r),i=e.readUInt16BE(r+4),a=e.readUInt32BE(r+6);ee.statement.columns[s]={name:p.column.from?p.column.from(e.toString("utf8",n,r-1)):e.toString("utf8",n,r-1),parser:h[a],table:t,number:i,type:a},r+=18}if($.statement=ee.statement,ee.onlyDescribe)return ee.resolve(ee.statement),ae(Qn)}async function $e(e,t=e.readUInt32BE(5)){(3===t?je:5===t?Pe:10===t?Ae:11===t?Ce:12===t?Ie:0!==t?He:Jn)(e,t)}async function je(){const e=await qe();ae(Rn().p().str(e).z(1).end())}async function Pe(e){const t="md5"+await Xn(Buffer.concat([Buffer.from(await Xn(await qe()+l)),e.subarray(9)]));ae(Rn().p().str(t).z(1).end())}async function Ae(){X=(await An.randomBytes(18)).toString("base64"),Rn().p().str("SCRAM-SHA-256"+Rn.N);const e=Rn.i;ae(Rn.inc(4).str("n,,n=*,r="+X).i32(Rn.i-e-4,e).end())}async function Ce(e){const t=e.toString("utf8",9).split(",").reduce(((e,t)=>(e[t[0]]=t.slice(2),e)),{}),n=await An.pbkdf2Sync(await qe(),Buffer.from(t.s,"base64"),parseInt(t.i),32,"sha256"),r=await er(n,"Client Key"),s="n=*,r="+X+",r="+t.r+",s="+t.s+",i="+t.i+",c=biws,r="+t.r;U=(await er(await er(n,"Server Key"),s)).toString("base64");const i="c=biws,r="+t.r+",p="+function(e,t){const n=Math.max(e.length,t.length),r=Buffer.allocUnsafe(n);for(let s=0;s<n;s++)r[s]=e[s]^t[s];return r}(r,Buffer.from(await er(await function(e){return An.createHash("sha256").update(e).digest()}(r),s))).toString("base64");ae(Rn().p().str(i).end())}function Ie(e){e.toString("utf8",9).split(Rn.N,1)[0].slice(2)!==U&&(me(Ut.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),E.destroy())}function qe(){return Promise.resolve("function"==typeof t.pass?t.pass():t.pass)}function De(){if($.statement=ee.statement,$.statement.columns=[],ee.onlyDescribe)return ee.resolve(ee.statement),ae(Qn)}function ze(e){x.pid=e.readUInt32BE(5),x.secret=e.readUInt32BE(9)}function Le(e){ee&&(ee.cursorFn||ee.describeFirst)&&ae(Qn);const t=Ut.postgres(Hn(e));ee&&ee.retried?me(ee.retried):ee&&Wn.has(t.routine)?function(e,t){delete C[e.signature],e.retried=t,re(e)}(ee,t):me(t)}function Be(e){if(!m)return;let t=9;for(;0!==e[t++];);m(e.toString("utf8",9,t-1),e.toString("utf8",t,e.length-1))}async function Re(){try{const e=await Promise.resolve(ee.cursorFn($));M=0,e===Rt?ae(function(e=""){return Buffer.concat([Rn().C().str("P").str(e+Rn.N).end(),Rn().S().end()])}(ee.portal)):($=new qn,ae(nt("",ee.cursorRows)))}catch(e){ae(Qn),ee.reject(e)}}function Ze(){$.count&&ee.cursorFn($),ee.resolve($)}function Me(){W=new Cn.Writable({autoDestroy:!0,write(e,t,n){E.write(Rn().d().raw(e).end(),n)},destroy(e,t){t(e),E.write(Rn().f().str(e+Rn.N).end()),W=null},final(e){E.write(Rn().c().end()),te=e}}),ee.resolve(W)}function Ue(){W=new Cn.Readable({read(){E.resume()}}),ee.resolve(W)}function Qe(){W=new Cn.Duplex({autoDestroy:!0,read(){E.resume()},write(e,t,n){E.write(Rn().d().raw(e).end(),n)},destroy(e,t){t(e),E.write(Rn().f().str(e+Rn.N).end()),W=null},final(e){E.write(Rn().c().end()),te=e}}),ee.resolve(W)}function Fe(e){W&&(W.push(e.subarray(5))||E.pause())}function Ve(){W&&W.push(null),W=null}function Ke(e){f?f(Hn(e)):console.log(Hn(e))}function Ge(){}function Je(){me(Ut.notSupported("FunctionCallResponse"))}function We(){me(Ut.notSupported("NegotiateProtocolVersion"))}function Ye(e){console.error("Postgres.js : Unknown Message:",e[0])}function He(e,t){console.error("Postgres.js : Unknown Auth:",t)}function Xe(e,n,r="",s=""){let i,a;return Rn().B().str(s+Rn.N).str(r+Rn.N).i16(0).i16(e.length),e.forEach(((r,s)=>{if(null===r)return Rn.i32(4294967295);a=n[s],e[s]=r=a in t.serializers?t.serializers[a](r):""+r,i=Rn.i,Rn.inc(4).str(r).i32(Rn.i-i-4,i)})),Rn.i16(0),Rn.end()}function et(e,t,n,r=""){return Rn().P().str(r+Rn.N).str(e+Rn.N).i16(t.length),t.forEach(((e,t)=>Rn.i32(n[t]||0))),Rn.end()}function tt(e,t=""){return Rn().D().str(e).str(t+Rn.N).end()}function nt(e="",t=0){return Buffer.concat([Rn().E().str(e+Rn.N).i32(t).end(),Fn])}};let Un=1;const Qn=Rn().S().end(),Fn=Rn().H().end(),Vn=Rn().i32(8).i32(80877103).end(8),Kn=Buffer.concat([Rn().E().str(Rn.N).i32(0).end(),Qn]),Gn=Rn().D().str("S").str(Rn.N).end(),Jn=()=>{},Wn=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),Yn={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Hn(e){const t={};let n=5;for(let r=5;r<e.length-1;r++)0===e[r]&&(t[Yn[e[n]]]=e.toString("utf8",n+1,r),n=r+1);return t}function Xn(e){return An.createHash("md5").update(e).digest("hex")}function er(e,t){return An.createHmac("sha256",e).update(t).digest()}function tr(e,t){if(!(t="function"==typeof t?t():t))return{cancel:Jn,start:Jn};let n;return{cancel(){n&&(clearTimeout(n),n=null)},start(){n&&clearTimeout(n),n=setTimeout(r,1e3*t,arguments)}};function r(t){e.apply(null,t),n=null}}const nr=()=>{};function rr(e,t,n,r){let s,i,a;const o=r.raw?new Array(t.length):{};for(let l=0;l<t.length;l++)s=e[n++],i=t[l],a=110===s?null:117===s?void 0:void 0===i.parser?e.toString("utf8",n+4,n+=4+e.readUInt32BE(n)):!0===i.parser.array?i.parser(e.toString("utf8",n+5,n+=4+e.readUInt32BE(n))):i.parser(e.toString("utf8",n+4,n+=4+e.readUInt32BE(n))),r.raw?o[l]=!0===r.raw?a:r.value.from?r.value.from(a,i):a:o[i.name]=r.value.from?r.value.from(a,i):a;return{i:n,row:r.row.from?r.row.from(o):o}}function sr(e,t,n=393216){return new Promise((async(r,s)=>{await e.begin((async e=>{let s;!t&&([{oid:t}]=await(e`select lo_creat(-1) as oid`));const[{fd:i}]=await(e`select lo_open(${t}, ${n}) as fd`),a={writable:async function({highWaterMark:e=16384,start:t=0}={}){return t&&await a.seek(t),new Cn.Writable({highWaterMark:e,write(e,t,n){a.write(e).then((()=>n()),n)}})},readable:async function({highWaterMark:e=16384,start:t=0,end:n=1/0}={}){let r=n-t;return t&&await a.seek(t),new Cn.Readable({highWaterMark:e,async read(e){const t=e>r?e-r:e;r-=e;const[{data:n}]=await a.read(t);this.push(n),n.length<e&&this.push(null)}})},close:()=>e`select lo_close(${i})`.then(s),tell:()=>e`select lo_tell64(${i})`,read:t=>e`select loread(${i}, ${t}) as data`,write:t=>e`select lowrite(${i}, ${t})`,truncate:t=>e`select lo_truncate64(${i}, ${t})`,seek:(t,n=0)=>e`select lo_lseek64(${i}, ${t}, ${n})`,size:()=>e`
          select
            lo_lseek64(${i}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return r(a),new Promise((async e=>s=e))})).catch(s)}))}Object.assign(ar,{PostgresError:Mt,toPascal:wn,pascal:En,toCamel:bn,camel:kn,toKebab:Sn,kebab:$n,fromPascal:Nn,fromCamel:xn,fromKebab:Tn,BigInt:{to:20,from:[20],parse:e=>BigInt(e),serialize:e=>e.toString()}});const ir=ar;function ar(e,t){const n=function(e,t){if(e&&e.shared)return e;const n=process.env,r=(e&&"string"!=typeof e?e:t)||{},{url:s,multihost:i}=function(e){if(!e||"string"!=typeof e)return{url:{searchParams:new Map}};let t=e;t=t.slice(t.indexOf("://")+3).split(/[?/]/)[0],t=decodeURIComponent(t.slice(t.indexOf("@")+1));const n=new URL(e.replace(t,t.split(",")[0]));return{url:{username:decodeURIComponent(n.username),password:decodeURIComponent(n.password),host:n.host,hostname:n.hostname,port:n.port,pathname:n.pathname,searchParams:n.searchParams},multihost:t.indexOf(",")>-1&&t}}(e),a=[...s.searchParams].reduce(((e,[t,n])=>(e[t]=n,e)),{}),o=r.hostname||r.host||i||s.hostname||n.PGHOST||"localhost",l=r.port||s.port||n.PGPORT||5432,c=r.user||r.username||s.username||n.PGUSERNAME||n.PGUSER||function(){try{return qt.userInfo().username}catch(e){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();r.no_prepare&&(r.prepare=!1),a.sslmode&&(a.ssl=a.sslmode,delete a.sslmode),"timeout"in r&&(console.log("The timeout option is deprecated, use idle_timeout instead"),r.idle_timeout=r.timeout),"system"===a.sslrootcert&&(a.ssl="verify-full");const u=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],d={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:cr,max_pipeline:100,backoff:lr,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(o)?o:o.split(",").map((e=>e.split(":")[0])),port:Array.isArray(l)?l:o.split(",").map((e=>parseInt(e.split(":")[1]||l))),path:r.path||o.indexOf("/")>-1&&o+"/.s.PGSQL."+l,database:r.database||r.db||(s.pathname||"").slice(1)||n.PGDATABASE||c,user:c,pass:r.pass||r.password||s.password||n.PGPASSWORD||"",...Object.entries(d).reduce(((e,[t,s])=>{const i=t in r?r[t]:t in a?"disable"!==a[t]&&"false"!==a[t]&&a[t]:n["PG"+t.toUpperCase()]||s;return e[t]="string"==typeof i&&u.includes(t)?+i:i,e}),{}),connection:{application_name:"postgres.js",...r.connection,...Object.entries(a).reduce(((e,[t,n])=>(t in d||(e[t]=n),e)),{})},types:r.types||{},target_session_attrs:or(r,s,n),onnotice:r.onnotice,onnotify:r.onnotify,onclose:r.onclose,onparameter:r.onparameter,socket:r.socket,transform:(h=r.transform||{undefined:void 0},{undefined:h.undefined,column:{from:"function"==typeof h.column?h.column:h.column&&h.column.from,to:h.column&&h.column.to},value:{from:"function"==typeof h.value?h.value:h.value&&h.value.from,to:h.value&&h.value.to},row:{from:"function"==typeof h.row?h.row:h.row&&h.row.from,to:h.row&&h.row.to}}),parameters:{},shared:{retries:0,typeArrayMap:{}},...cn(r.types)};var h}(e,t),r=n.no_subscribe||function(e,t){const n=new Map,r="postgresjs_"+Math.random().toString(36).slice(2),s={};let i,a,o=!1;const l=d.sql=e({...t,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...t.connection,replication:"database"},onclose:async function(){o||(a=null,s.pid=s.secret=void 0,h(await p(l,r,t.publications)),n.forEach((e=>e.forEach((({onsubscribe:e})=>e())))))},no_subscribe:!0}),c=l.end,u=l.close;return l.end=async()=>(o=!0,a&&await new Promise((e=>(a.once("close",e),a.end()))),c()),l.close=async()=>(a&&await new Promise((e=>(a.once("close",e),a.end()))),u()),d;async function d(e,a,o=nr){e=function(e){const t=e.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!t)throw new Error("Malformed subscribe pattern: "+e);const[,n,r,s]=t;return(n||"*")+(r?":"+(-1===r.indexOf(".")?"public."+r:r):"")+(s?"="+s:"")}(e),i||(i=p(l,r,t.publications));const c={fn:a,onsubscribe:o},u=n.has(e)?n.get(e).add(c):n.set(e,new Set([c])).get(e),d=()=>{u.delete(c),0===u.size&&n.delete(e)};return i.then((e=>(h(e),o(),{unsubscribe:d,state:s,sql:l})))}function h(e){a=e.stream,s.pid=e.state.pid,s.secret=e.state.secret}async function p(e,n,r){if(!r)throw new Error("Missing publication names");const s=await e.unsafe(`CREATE_REPLICATION_SLOT ${n} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[i]=s,a=await e.unsafe(`START_REPLICATION SLOT ${n} LOGICAL ${i.consistent_point} (proto_version '1', publication_names '${r}')`).writable(),o={lsn:Buffer.concat(i.consistent_point.split("/").map((e=>Buffer.from(("00000000"+e).slice(-8),"hex"))))};return a.on("data",(function(n){119===n[0]?function(e,t,n,r,s){Object.entries({R:e=>{let r=1;const i=t[e.readUInt32BE(r)]={schema:e.toString("utf8",r+=4,r=e.indexOf(0,r))||"pg_catalog",table:e.toString("utf8",r+1,r=e.indexOf(0,r+1)),columns:Array(e.readUInt16BE(r+=2)),keys:[]};r+=2;let a,o=0;for(;r<e.length;)a=i.columns[o++]={key:e[r++],name:s.column.from?s.column.from(e.toString("utf8",r,r=e.indexOf(0,r))):e.toString("utf8",r,r=e.indexOf(0,r)),type:e.readUInt32BE(r+=1),parser:n[e.readUInt32BE(r)],atttypmod:e.readUInt32BE(r+=4)},a.key&&i.keys.push(a),r+=4},Y:()=>{},O:()=>{},B:e=>{t.date=function(e){return new Date(Date.UTC(2e3,0,1)+Number(e/BigInt(1e3)))}(e.readBigInt64BE(9)),t.lsn=e.subarray(1,9)},I:e=>{let n=1;const i=t[e.readUInt32BE(n)],{row:a}=rr(e,i.columns,n+=7,s);r(a,{command:"insert",relation:i})},D:e=>{let n=1;const i=t[e.readUInt32BE(n)];n+=4;const a=75===e[n];r(a||79===e[n]?rr(e,i.columns,n+=3,s).row:null,{command:"delete",relation:i,key:a})},U:e=>{let n=1;const i=t[e.readUInt32BE(n)];n+=4;const a=75===e[n],o=a||79===e[n]?rr(e,i.columns,n+=3,s):null;o&&(n=o.i);const{row:l}=rr(e,i.columns,n+3,s);r(l,{command:"update",relation:i,key:a,old:o&&o.row})},T:()=>{},C:()=>{}}).reduce(((e,[t,n])=>(e[t.charCodeAt(0)]=n,e)),{})[e[0]](e)}(n.subarray(25),o,e.options.parsers,l,t.transform):107===n[0]&&n[17]&&function(){const e=Buffer.alloc(34);e[0]="r".charCodeAt(0),e.fill(o.lsn,1),e.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),a.write(e)}()})),a.on("error",(function(e){console.error("Unexpected error during logical streaming - reconnecting",e)})),a.on("close",e.close),{stream:a,state:s.state};function l(e,t){const n=t.relation.schema+"."+t.relation.table;f("*",e,t),f("*:"+n,e,t),t.relation.keys.length&&f("*:"+n+"="+t.relation.keys.map((t=>e[t.name])),e,t),f(t.command,e,t),f(t.command+":"+n,e,t),t.relation.keys.length&&f(t.command+":"+n+"="+t.relation.keys.map((t=>e[t.name])),e,t)}}function f(e,t,r){n.has(e)&&n.get(e).forEach((({fn:n})=>n(t,r,e)))}}(ar,{...n});let s=!1;const i=Dn(),a=Dn(),o=Dn(),l=Dn(),c=Dn(),u=Dn(),d=Dn(),h=Dn(),p={connecting:a,reserved:o,closed:l,ended:c,open:u,busy:d,full:h},f=[...Array(n.max)].map((()=>Mn(n,p,{onopen:k,onend:O,onclose:E}))),m=g((function(e){return s?e.reject(Ut.connection("CONNECTION_ENDED",n,n)):u.length?S(u.shift(),e):l.length?T(l.shift(),e):void(d.length?S(d.shift(),e):i.push(e))}));return Object.assign(m,{get parameters(){return n.parameters},largeObject:sr.bind(null,m),subscribe:r,CLOSE:Rt,END:Rt,PostgresError:Mt,options:n,reserve:async function(){const e=Dn(),t=u.length?u.shift():await new Promise((e=>{i.push({reserve:e}),l.length&&T(l.shift())}));_(t,o),t.reserved=()=>e.length?t.execute(e.shift()):_(t,o),t.reserved.release=!0;const n=g((function(n){t.queue===h?e.push(n):t.execute(n)||_(t,h)}));return n.release=()=>{t.reserved=null,k(t)},n},listen:y,begin:async function(e,t){!t&&(t=e,e="");const n=Dn();let r,s=0,i=null;try{return await m.unsafe("begin "+e.replace(/[^a-z ]/gi,""),[],{onexecute:function(e){r=e,_(e,o),e.reserved=()=>n.length?e.execute(n.shift()):_(e,o)}}).execute(),await Promise.race([async function e(t,r,a){const o=g((function(e){e.catch((e=>l||(l=e))),t.queue===h?n.push(e):t.execute(e)||_(t,h)}));let l,c;o.savepoint=function n(r,i){return r&&Array.isArray(r.raw)?n((e=>e.apply(e,arguments))):(1===arguments.length&&(i=r,r=null),e(t,i,"s"+s+++(r?"_"+r:"")))},o.prepare=e=>i=e.replace(/[^a-z0-9$-_. ]/gi),a&&await(o`savepoint ${o(a)}`);try{if(c=await new Promise(((e,t)=>{const n=r(o);Promise.resolve(Array.isArray(n)?Promise.all(n):n).then(e,t)})),l)throw l}catch(e){throw await(a?o`rollback to ${o(a)}`:o`rollback`),e instanceof Mt&&"25P02"===e.code&&l||e}return a||(i?await(o`prepare transaction '${o.unsafe(i)}'`):await(o`commit`)),c}(r,t),new Promise(((e,t)=>r.onclose=t))])}catch(e){throw e}},close:async function(){await Promise.all(f.map((e=>e.end())))},end:async function({timeout:e=null}={}){if(s)return s;let t;return await 1,s=Promise.race([new Promise((n=>null!==e&&(t=setTimeout(N,1e3*e,n)))),Promise.all(f.map((e=>e.end())).concat(y.sql?y.sql.end({timeout:0}):[],r.sql?r.sql.end({timeout:0}):[]))]).then((()=>clearTimeout(t)))}}),m;function g(e){return e.debug=n.debug,Object.entries(n.types).reduce(((e,[t,n])=>(e[t]=e=>new Kt(e,n.to),e)),t),Object.assign(r,{types:t,typed:t,unsafe:function(t,n=[],r={}){2===arguments.length&&!Array.isArray(n)&&(r=n,n=[]);return new Zt([t],n,e,x,{prepare:!1,...r,simple:"simple"in r?r.simple:0===n.length})},notify:v,array:w,json:b,file:function(t,n=[],r={}){2===arguments.length&&!Array.isArray(n)&&(r=n,n=[]);return new Zt([],n,(n=>{Dt.readFile(t,"utf8",((t,r)=>{if(t)return n.reject(t);n.strings=[r],e(n)}))}),x,{...r,simple:"simple"in r?r.simple:0===n.length})}}),r;function t(e,t){return new Kt(e,t)}function r(t,...r){return t&&Array.isArray(t.raw)?new Zt(t,r,e,x):"string"!=typeof t||r.length?new Gt(t,r):new Vt(n.transform.column.to?n.transform.column.to(t):t)}}async function y(e,t,r){const s={fn:t,onlisten:r},i=y.sql||(y.sql=ar({...n,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(y.channels).forEach((([e,{listeners:t}])=>{delete y.channels[e],Promise.all(t.map((t=>y(e,t.fn,t.onlisten).catch((()=>{})))))}))},onnotify(e,t){e in y.channels&&y.channels[e].listeners.forEach((e=>e.fn(t)))}})),a=y.channels||(y.channels={});if(e in a){a[e].listeners.push(s);const t=await a[e].result;return s.onlisten&&s.onlisten(),{state:t.state,unlisten:l}}a[e]={result:i`listen ${i.unsafe('"'+e.replace(/"/g,'""')+'"')}`,listeners:[s]};const o=await a[e].result;return s.onlisten&&s.onlisten(),{state:o.state,unlisten:l};async function l(){if(e in a!=0&&(a[e].listeners=a[e].listeners.filter((e=>e!==s)),!a[e].listeners.length))return delete a[e],i`unlisten ${i.unsafe('"'+e.replace(/"/g,'""')+'"')}`}}async function v(e,t){return await(m`select pg_notify(${e}, ${""+t})`)}function _(e,t){return e.queue.remove(e),t.push(e),e.queue=t,t===u?e.idleTimer.start():e.idleTimer.cancel(),e}function b(e){return new Kt(e,3802)}function w(e,t){return Array.isArray(e)?new Kt(e,t||(e.length?pn(e)||25:0),n.shared.typeArrayMap):w(Array.from(arguments))}function S(e,t){return e.execute(t)?_(e,d):_(e,h)}function x(e){return new Promise(((t,r)=>{e.state?e.active?Mn(n).cancel(e.state,t,r):e.cancelled={resolve:t,reject:r}:(i.remove(e),e.cancelled=!0,e.reject(Ut.generic("57014","canceling statement due to user request")),t())}))}async function N(e){for(await Promise.all(f.map((e=>e.terminate())));i.length;)i.shift().reject(Ut.connection("CONNECTION_DESTROYED",n));e()}function T(e,t){return _(e,a),e.connect(t),e}function O(e){_(e,c)}function k(e){if(0===i.length)return _(e,u);let t=Math.ceil(i.length/(a.length+1)),n=!0;for(;n&&i.length&&t-- >0;){const t=i.shift();if(t.reserve)return t.reserve(e);n=e.execute(t)}_(e,n?d:h)}function E(e,t){_(e,l),e.reserved=null,e.onclose&&(e.onclose(t),e.onclose=null),n.onclose&&n.onclose(e.id),i.length&&T(e,i.shift())}}function or(e,t,n){const r=e.target_session_attrs||t.searchParams.get("target_session_attrs")||n.PGTARGETSESSIONATTRS;if(!r||["read-write","read-only","primary","standby","prefer-standby"].includes(r))return r;throw new Error("target_session_attrs "+r+" is not supported")}function lr(e){return(.5+Math.random()/2)*Math.min(3**e/100,20)}function cr(){return 60*(30+30*Math.random())}var ur=n(738),dr=n.n(ur);class hr extends ze{static[e]="PgBoolean";getSQLType(){return"boolean"}}class pr extends De{static[e]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new fr(e,this.config)}}class fr extends ze{static[e]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function mr(e,t={}){return new pr(e,t)}const gr=Symbol.for("drizzle:MySqlInlineForeignKeys");class yr extends g{static[e]="MySqlTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:gr});[g.Symbol.Columns];[gr]=[];[g.Symbol.ExtraConfigBuilder]=void 0}class vr extends o{constructor(e,t){t.uniqueName||(t.uniqueName=function(e,t){return`${e[yr.Symbol.Name]}_${t.join("_")}_unique`}(e,[t.name])),super(e,t),this.table=e}static[e]="MySqlColumn"}class _r extends vr{static[e]="MySqlVarChar";length=this.config.length;enumValues=this.config.enum;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}class br extends vr{static[e]="MySqlVarBinary";length=this.config.length;getSQLType(){return void 0===this.length?"varbinary":`varbinary(${this.length})`}}class wr extends vr{static[e]="MySqlChar";length=this.config.length;enumValues=this.config.enum;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}class Sr extends ze{static[e]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}const xr=Symbol.for("drizzle:SQLiteInlineForeignKeys");class Nr extends g{static[e]="SQLiteTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:xr});[g.Symbol.Columns];[xr]=[];[g.Symbol.ExtraConfigBuilder]=void 0}class Tr extends o{constructor(e,t){t.uniqueName||(t.uniqueName=function(e,t){return`${e[Nr.Symbol.Name]}_${t.join("_")}_unique`}(e,[t.name])),super(e,t),this.table=e}static[e]="SQLiteColumn"}class Or extends Tr{static[e]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(e,t){super(e,t)}getSQLType(){return"text"+(this.config.length?`(${this.config.length})`:"")}}var kr,Er;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(kr||(kr={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Er||(Er={}));const $r=kr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),jr=e=>{switch(typeof e){case"undefined":return $r.undefined;case"string":return $r.string;case"number":return isNaN(e)?$r.nan:$r.number;case"boolean":return $r.boolean;case"function":return $r.function;case"bigint":return $r.bigint;case"symbol":return $r.symbol;case"object":return Array.isArray(e)?$r.array:null===e?$r.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?$r.promise:"undefined"!=typeof Map&&e instanceof Map?$r.map:"undefined"!=typeof Set&&e instanceof Set?$r.set:"undefined"!=typeof Date&&e instanceof Date?$r.date:$r.object;default:return $r.unknown}},Pr=kr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ar extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,r=0;for(;r<s.path.length;){const n=s.path[r];r===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,kr.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ar.create=e=>new Ar(e);const Cr=(e,t)=>{let n;switch(e.code){case Pr.invalid_type:n=e.received===$r.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Pr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,kr.jsonStringifyReplacer)}`;break;case Pr.unrecognized_keys:n=`Unrecognized key(s) in object: ${kr.joinValues(e.keys,", ")}`;break;case Pr.invalid_union:n="Invalid input";break;case Pr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${kr.joinValues(e.options)}`;break;case Pr.invalid_enum_value:n=`Invalid enum value. Expected ${kr.joinValues(e.options)}, received '${e.received}'`;break;case Pr.invalid_arguments:n="Invalid function arguments";break;case Pr.invalid_return_type:n="Invalid function return type";break;case Pr.invalid_date:n="Invalid date";break;case Pr.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:kr.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Pr.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Pr.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Pr.custom:n="Invalid input";break;case Pr.invalid_intersection_types:n="Intersection results could not be merged";break;case Pr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Pr.not_finite:n="Number must be finite";break;default:n=t.defaultError,kr.assertNever(e)}return{message:n}};let Ir=Cr;function qr(){return Ir}const Dr=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,i=[...n,...s.path||[]],a={...s,path:i};let o="";const l=r.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(a,{data:t,defaultError:o}).message;return{...s,path:i,message:s.message||o}};function zr(e,t){const n=Dr({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,qr(),Cr].filter((e=>!!e))});e.common.issues.push(n)}class Lr{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Br;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t)n.push({key:await e.key,value:await e.value});return Lr.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:s}=r;if("aborted"===t.status)return Br;if("aborted"===s.status)return Br;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!r.alwaysSet||(n[t.value]=s.value)}return{status:e.value,value:n}}}const Br=Object.freeze({status:"aborted"}),Rr=e=>({status:"dirty",value:e}),Zr=e=>({status:"valid",value:e}),Mr=e=>"aborted"===e.status,Ur=e=>"dirty"===e.status,Qr=e=>"valid"===e.status,Fr=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Vr;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Vr||(Vr={}));class Kr{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Gr=(e,t)=>{if(Qr(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ar(e.common.issues);return this._error=t,this._error}}};function Jr(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=r?r:t.defaultError}:{message:null!=n?n:t.defaultError},description:s}}class Wr{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return jr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:jr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Lr,ctx:{common:e.parent.common,data:e.data,parsedType:jr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Fr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jr(e)},s=this._parseSync({data:e,path:r.path,parent:r});return Gr(r,s)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jr(e)},r=this._parse({data:e,path:n.path,parent:n}),s=await(Fr(r)?r:Promise.resolve(r));return Gr(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const s=e(t),i=()=>r.addIssue({code:Pr.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(i(),!1))):!!s||(i(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new zs({schema:this,typeName:Js.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ls.create(this,this._def)}nullable(){return Bs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vs.create(this,this._def)}promise(){return Ds.create(this,this._def)}or(e){return ws.create([this,e],this._def)}and(e){return Ts.create(this,e,this._def)}transform(e){return new zs({...Jr(this._def),schema:this,typeName:Js.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Rs({...Jr(this._def),innerType:this,defaultValue:t,typeName:Js.ZodDefault})}brand(){return new Qs({typeName:Js.ZodBranded,type:this,...Jr(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Zs({...Jr(this._def),innerType:this,catchValue:t,typeName:Js.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Fs.create(this,e)}readonly(){return Vs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Yr=/^c[^\s-]{8,}$/i,Hr=/^[a-z][a-z0-9]*$/,Xr=/^[0-9A-HJKMNP-TV-Z]{26}$/,es=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ts=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ns;const rs=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ss=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class is extends Wr{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==$r.string){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.string,received:t.parsedType}),Br}const t=new Lr;let n;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const r=e.data.length>a.value,s=e.data.length<a.value;(r||s)&&(n=this._getOrReturnCtx(e,n),r?zr(n,{code:Pr.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):s&&zr(n,{code:Pr.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)ts.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"email",code:Pr.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)ns||(ns=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ns.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"emoji",code:Pr.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)es.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"uuid",code:Pr.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)Yr.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"cuid",code:Pr.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)Hr.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"cuid2",code:Pr.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)Xr.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"ulid",code:Pr.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(r){n=this._getOrReturnCtx(e,n),zr(n,{validation:"url",code:Pr.invalid_string,message:a.message}),t.dirty()}else"regex"===a.kind?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"regex",code:Pr.invalid_string,message:a.message}),t.dirty())):"trim"===a.kind?e.data=e.data.trim():"includes"===a.kind?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):"toLowerCase"===a.kind?e.data=e.data.toLowerCase():"toUpperCase"===a.kind?e.data=e.data.toUpperCase():"startsWith"===a.kind?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):"endsWith"===a.kind?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):"datetime"===a.kind?((i=a).precision?i.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${i.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${i.precision}}Z$`):0===i.precision?i.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):i.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.invalid_string,validation:"datetime",message:a.message}),t.dirty()):"ip"===a.kind?(r=e.data,("v4"===(s=a.version)||!s)&&rs.test(r)||("v6"===s||!s)&&ss.test(r)||(n=this._getOrReturnCtx(e,n),zr(n,{validation:"ip",code:Pr.invalid_string,message:a.message}),t.dirty())):kr.assertNever(a);var r,s,i;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:Pr.invalid_string,...Vr.errToObj(n)})}_addCheck(e){return new is({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Vr.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Vr.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Vr.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Vr.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Vr.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Vr.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Vr.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Vr.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...Vr.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Vr.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Vr.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Vr.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Vr.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Vr.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Vr.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Vr.errToObj(t)})}nonempty(e){return this.min(1,Vr.errToObj(e))}trim(){return new is({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new is({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new is({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function as(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}is.create=e=>{var t;return new is({checks:[],typeName:Js.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Jr(e)})};class os extends Wr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==$r.number){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.number,received:t.parsedType}),Br}let t;const n=new Lr;for(const r of this._def.checks)"int"===r.kind?kr.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==as(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.not_finite,message:r.message}),n.dirty()):kr.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Vr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Vr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Vr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Vr.toString(t))}setLimit(e,t,n,r){return new os({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Vr.toString(r)}]})}_addCheck(e){return new os({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Vr.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Vr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Vr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Vr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Vr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Vr.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Vr.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Vr.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Vr.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&kr.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}os.create=e=>new os({checks:[],typeName:Js.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Jr(e)});class ls extends Wr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==$r.bigint){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.bigint,received:t.parsedType}),Br}let t;const n=new Lr;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),zr(t,{code:Pr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):kr.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Vr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Vr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Vr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Vr.toString(t))}setLimit(e,t,n,r){return new ls({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Vr.toString(r)}]})}_addCheck(e){return new ls({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Vr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Vr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Vr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Vr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Vr.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ls.create=e=>{var t;return new ls({checks:[],typeName:Js.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Jr(e)})};class cs extends Wr{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==$r.boolean){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.boolean,received:t.parsedType}),Br}return Zr(e.data)}}cs.create=e=>new cs({typeName:Js.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Jr(e)});class us extends Wr{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==$r.date){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.date,received:t.parsedType}),Br}if(isNaN(e.data.getTime()))return zr(this._getOrReturnCtx(e),{code:Pr.invalid_date}),Br;const t=new Lr;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),zr(n,{code:Pr.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):kr.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new us({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Vr.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Vr.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}us.create=e=>new us({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Js.ZodDate,...Jr(e)});class ds extends Wr{_parse(e){if(this._getType(e)!==$r.symbol){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.symbol,received:t.parsedType}),Br}return Zr(e.data)}}ds.create=e=>new ds({typeName:Js.ZodSymbol,...Jr(e)});class hs extends Wr{_parse(e){if(this._getType(e)!==$r.undefined){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.undefined,received:t.parsedType}),Br}return Zr(e.data)}}hs.create=e=>new hs({typeName:Js.ZodUndefined,...Jr(e)});class ps extends Wr{_parse(e){if(this._getType(e)!==$r.null){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.null,received:t.parsedType}),Br}return Zr(e.data)}}ps.create=e=>new ps({typeName:Js.ZodNull,...Jr(e)});class fs extends Wr{constructor(){super(...arguments),this._any=!0}_parse(e){return Zr(e.data)}}fs.create=e=>new fs({typeName:Js.ZodAny,...Jr(e)});class ms extends Wr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Zr(e.data)}}ms.create=e=>new ms({typeName:Js.ZodUnknown,...Jr(e)});class gs extends Wr{_parse(e){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.never,received:t.parsedType}),Br}}gs.create=e=>new gs({typeName:Js.ZodNever,...Jr(e)});class ys extends Wr{_parse(e){if(this._getType(e)!==$r.undefined){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.void,received:t.parsedType}),Br}return Zr(e.data)}}ys.create=e=>new ys({typeName:Js.ZodVoid,...Jr(e)});class vs extends Wr{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==$r.array)return zr(t,{code:Pr.invalid_type,expected:$r.array,received:t.parsedType}),Br;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(zr(t,{code:e?Pr.too_big:Pr.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(zr(t,{code:Pr.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(zr(t,{code:Pr.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Kr(t,e,t.path,n))))).then((e=>Lr.mergeArray(n,e)));const s=[...t.data].map(((e,n)=>r.type._parseSync(new Kr(t,e,t.path,n))));return Lr.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new vs({...this._def,minLength:{value:e,message:Vr.toString(t)}})}max(e,t){return new vs({...this._def,maxLength:{value:e,message:Vr.toString(t)}})}length(e,t){return new vs({...this._def,exactLength:{value:e,message:Vr.toString(t)}})}nonempty(e){return this.min(1,e)}}function _s(e){if(e instanceof bs){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Ls.create(_s(r))}return new bs({...e._def,shape:()=>t})}return e instanceof vs?new vs({...e._def,type:_s(e.element)}):e instanceof Ls?Ls.create(_s(e.unwrap())):e instanceof Bs?Bs.create(_s(e.unwrap())):e instanceof Os?Os.create(e.items.map((e=>_s(e)))):e}vs.create=(e,t)=>new vs({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Js.ZodArray,...Jr(t)});class bs extends Wr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=kr.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==$r.object){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.object,received:t.parsedType}),Br}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),i=[];if(!(this._def.catchall instanceof gs&&"strip"===this._def.unknownKeys))for(const e in n.data)s.includes(e)||i.push(e);const a=[];for(const e of s){const t=r[e],s=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new Kr(n,s,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof gs){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)i.length>0&&(zr(n,{code:Pr.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const r=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new Kr(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of a){const n=await t.key;e.push({key:n,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>Lr.mergeObjectSync(t,e))):Lr.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Vr.errToObj,new bs({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,s,i,a;const o=null!==(i=null===(s=(r=this._def).errorMap)||void 0===s?void 0:s.call(r,t,n).message)&&void 0!==i?i:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=Vr.errToObj(e).message)&&void 0!==a?a:o}:{message:o}}}:{}})}strip(){return new bs({...this._def,unknownKeys:"strip"})}passthrough(){return new bs({...this._def,unknownKeys:"passthrough"})}extend(e){return new bs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new bs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Js.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new bs({...this._def,catchall:e})}pick(e){const t={};return kr.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new bs({...this._def,shape:()=>t})}omit(e){const t={};return kr.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new bs({...this._def,shape:()=>t})}deepPartial(){return _s(this)}partial(e){const t={};return kr.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()})),new bs({...this._def,shape:()=>t})}required(e){const t={};return kr.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Ls;)e=e._def.innerType;t[n]=e}})),new bs({...this._def,shape:()=>t})}keyof(){return Cs(kr.objectKeys(this.shape))}}bs.create=(e,t)=>new bs({shape:()=>e,unknownKeys:"strip",catchall:gs.create(),typeName:Js.ZodObject,...Jr(t)}),bs.strictCreate=(e,t)=>new bs({shape:()=>e,unknownKeys:"strict",catchall:gs.create(),typeName:Js.ZodObject,...Jr(t)}),bs.lazycreate=(e,t)=>new bs({shape:e,unknownKeys:"strip",catchall:gs.create(),typeName:Js.ZodObject,...Jr(t)});class ws extends Wr{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new Ar(e.ctx.common.issues)));return zr(t,{code:Pr.invalid_union,unionErrors:n}),Br}));{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},i=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=r.map((e=>new Ar(e)));return zr(t,{code:Pr.invalid_union,unionErrors:s}),Br}}get options(){return this._def.options}}ws.create=(e,t)=>new ws({options:e,typeName:Js.ZodUnion,...Jr(t)});const Ss=e=>e instanceof Ps?Ss(e.schema):e instanceof zs?Ss(e.innerType()):e instanceof As?[e.value]:e instanceof Is?e.options:e instanceof qs?Object.keys(e.enum):e instanceof Rs?Ss(e._def.innerType):e instanceof hs?[void 0]:e instanceof ps?[null]:null;class xs extends Wr{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==$r.object)return zr(t,{code:Pr.invalid_type,expected:$r.object,received:t.parsedType}),Br;const n=this.discriminator,r=t.data[n],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(zr(t,{code:Pr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Br)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=Ss(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,n)}}return new xs({typeName:Js.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...Jr(n)})}}function Ns(e,t){const n=jr(e),r=jr(t);if(e===t)return{valid:!0,data:e};if(n===$r.object&&r===$r.object){const n=kr.objectKeys(t),r=kr.objectKeys(e).filter((e=>-1!==n.indexOf(e))),s={...e,...t};for(const n of r){const r=Ns(e[n],t[n]);if(!r.valid)return{valid:!1};s[n]=r.data}return{valid:!0,data:s}}if(n===$r.array&&r===$r.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const s=Ns(e[r],t[r]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===$r.date&&r===$r.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Ts extends Wr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Mr(e)||Mr(r))return Br;const s=Ns(e.value,r.value);return s.valid?((Ur(e)||Ur(r))&&t.dirty(),{status:t.value,value:s.data}):(zr(n,{code:Pr.invalid_intersection_types}),Br)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ts.create=(e,t,n)=>new Ts({left:e,right:t,typeName:Js.ZodIntersection,...Jr(n)});class Os extends Wr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==$r.array)return zr(n,{code:Pr.invalid_type,expected:$r.array,received:n.parsedType}),Br;if(n.data.length<this._def.items.length)return zr(n,{code:Pr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Br;!this._def.rest&&n.data.length>this._def.items.length&&(zr(n,{code:Pr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Kr(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>Lr.mergeArray(t,e))):Lr.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Os({...this._def,rest:e})}}Os.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Os({items:e,typeName:Js.ZodTuple,rest:null,...Jr(t)})};class ks extends Wr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==$r.object)return zr(n,{code:Pr.invalid_type,expected:$r.object,received:n.parsedType}),Br;const r=[],s=this._def.keyType,i=this._def.valueType;for(const e in n.data)r.push({key:s._parse(new Kr(n,e,n.path,e)),value:i._parse(new Kr(n,n.data[e],n.path,e))});return n.common.async?Lr.mergeObjectAsync(t,r):Lr.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new ks(t instanceof Wr?{keyType:e,valueType:t,typeName:Js.ZodRecord,...Jr(n)}:{keyType:is.create(),valueType:e,typeName:Js.ZodRecord,...Jr(t)})}}class Es extends Wr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==$r.map)return zr(n,{code:Pr.invalid_type,expected:$r.map,received:n.parsedType}),Br;const r=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map((([e,t],i)=>({key:r._parse(new Kr(n,e,n.path,[i,"key"])),value:s._parse(new Kr(n,t,n.path,[i,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of i){const r=await n.key,s=await n.value;if("aborted"===r.status||"aborted"===s.status)return Br;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of i){const r=n.key,s=n.value;if("aborted"===r.status||"aborted"===s.status)return Br;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}Es.create=(e,t,n)=>new Es({valueType:t,keyType:e,typeName:Js.ZodMap,...Jr(n)});class $s extends Wr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==$r.set)return zr(n,{code:Pr.invalid_type,expected:$r.set,received:n.parsedType}),Br;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(zr(n,{code:Pr.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(zr(n,{code:Pr.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function i(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Br;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map(((e,t)=>s._parse(new Kr(n,e,n.path,t))));return n.common.async?Promise.all(a).then((e=>i(e))):i(a)}min(e,t){return new $s({...this._def,minSize:{value:e,message:Vr.toString(t)}})}max(e,t){return new $s({...this._def,maxSize:{value:e,message:Vr.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}$s.create=(e,t)=>new $s({valueType:e,minSize:null,maxSize:null,typeName:Js.ZodSet,...Jr(t)});class js extends Wr{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==$r.function)return zr(t,{code:Pr.invalid_type,expected:$r.function,received:t.parsedType}),Br;function n(e,n){return Dr({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,qr(),Cr].filter((e=>!!e)),issueData:{code:Pr.invalid_arguments,argumentsError:n}})}function r(e,n){return Dr({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,qr(),Cr].filter((e=>!!e)),issueData:{code:Pr.invalid_return_type,returnTypeError:n}})}const s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof Ds){const e=this;return Zr((async function(...t){const a=new Ar([]),o=await e._def.args.parseAsync(t,s).catch((e=>{throw a.addIssue(n(t,e)),a})),l=await Reflect.apply(i,this,o);return await e._def.returns._def.type.parseAsync(l,s).catch((e=>{throw a.addIssue(r(l,e)),a}))}))}{const e=this;return Zr((function(...t){const a=e._def.args.safeParse(t,s);if(!a.success)throw new Ar([n(t,a.error)]);const o=Reflect.apply(i,this,a.data),l=e._def.returns.safeParse(o,s);if(!l.success)throw new Ar([r(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new js({...this._def,args:Os.create(e).rest(ms.create())})}returns(e){return new js({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new js({args:e||Os.create([]).rest(ms.create()),returns:t||ms.create(),typeName:Js.ZodFunction,...Jr(n)})}}class Ps extends Wr{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ps.create=(e,t)=>new Ps({getter:e,typeName:Js.ZodLazy,...Jr(t)});class As extends Wr{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return zr(t,{received:t.data,code:Pr.invalid_literal,expected:this._def.value}),Br}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Cs(e,t){return new Is({values:e,typeName:Js.ZodEnum,...Jr(t)})}As.create=(e,t)=>new As({value:e,typeName:Js.ZodLiteral,...Jr(t)});class Is extends Wr{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return zr(t,{expected:kr.joinValues(n),received:t.parsedType,code:Pr.invalid_type}),Br}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return zr(t,{received:t.data,code:Pr.invalid_enum_value,options:n}),Br}return Zr(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Is.create(e)}exclude(e){return Is.create(this.options.filter((t=>!e.includes(t))))}}Is.create=Cs;class qs extends Wr{_parse(e){const t=kr.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==$r.string&&n.parsedType!==$r.number){const e=kr.objectValues(t);return zr(n,{expected:kr.joinValues(e),received:n.parsedType,code:Pr.invalid_type}),Br}if(-1===t.indexOf(e.data)){const e=kr.objectValues(t);return zr(n,{received:n.data,code:Pr.invalid_enum_value,options:e}),Br}return Zr(e.data)}get enum(){return this._def.values}}qs.create=(e,t)=>new qs({values:e,typeName:Js.ZodNativeEnum,...Jr(t)});class Ds extends Wr{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==$r.promise&&!1===t.common.async)return zr(t,{code:Pr.invalid_type,expected:$r.promise,received:t.parsedType}),Br;const n=t.parsedType===$r.promise?t.data:Promise.resolve(t.data);return Zr(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Ds.create=(e,t)=>new Ds({type:e,typeName:Js.ZodPromise,...Jr(t)});class zs extends Wr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Js.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,s={addIssue:e=>{zr(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===r.type){const e=r.transform(n.data,s);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n}))):this._def.schema._parseSync({data:e,path:n.path,parent:n})}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Br:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Br:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Qr(e))return e;const i=r.transform(e.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>Qr(e)?Promise.resolve(r.transform(e.value,s)).then((e=>({status:t.value,value:e}))):e))}kr.assertNever(r)}}zs.create=(e,t,n)=>new zs({schema:e,typeName:Js.ZodEffects,effect:t,...Jr(n)}),zs.createWithPreprocess=(e,t,n)=>new zs({schema:t,effect:{type:"preprocess",transform:e},typeName:Js.ZodEffects,...Jr(n)});class Ls extends Wr{_parse(e){return this._getType(e)===$r.undefined?Zr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ls.create=(e,t)=>new Ls({innerType:e,typeName:Js.ZodOptional,...Jr(t)});class Bs extends Wr{_parse(e){return this._getType(e)===$r.null?Zr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Bs.create=(e,t)=>new Bs({innerType:e,typeName:Js.ZodNullable,...Jr(t)});class Rs extends Wr{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===$r.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Rs.create=(e,t)=>new Rs({innerType:e,typeName:Js.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Jr(t)});class Zs extends Wr{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Fr(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Ar(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Ar(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Zs.create=(e,t)=>new Zs({innerType:e,typeName:Js.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Jr(t)});class Ms extends Wr{_parse(e){if(this._getType(e)!==$r.nan){const t=this._getOrReturnCtx(e);return zr(t,{code:Pr.invalid_type,expected:$r.nan,received:t.parsedType}),Br}return{status:"valid",value:e.data}}}Ms.create=e=>new Ms({typeName:Js.ZodNaN,...Jr(e)});const Us=Symbol("zod_brand");class Qs extends Wr{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Fs extends Wr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Br:"dirty"===e.status?(t.dirty(),Rr(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Br:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Fs({in:e,out:t,typeName:Js.ZodPipeline})}}class Vs extends Wr{_parse(e){const t=this._def.innerType._parse(e);return Qr(t)&&(t.value=Object.freeze(t.value)),t}}Vs.create=(e,t)=>new Vs({innerType:e,typeName:Js.ZodReadonly,...Jr(t)});const Ks=(e,t={},n)=>e?fs.create().superRefine(((r,s)=>{var i,a;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,o=null===(a=null!==(i=e.fatal)&&void 0!==i?i:n)||void 0===a||a,l="string"==typeof e?{message:e}:e;s.addIssue({code:"custom",...l,fatal:o})}})):fs.create(),Gs={object:bs.lazycreate};var Js;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Js||(Js={}));const Ws=is.create,Ys=os.create,Hs=Ms.create,Xs=ls.create,ei=cs.create,ti=us.create,ni=ds.create,ri=hs.create,si=ps.create,ii=fs.create,ai=ms.create,oi=gs.create,li=ys.create,ci=vs.create,ui=bs.create,di=bs.strictCreate,hi=ws.create,pi=xs.create,fi=Ts.create,mi=Os.create,gi=ks.create,yi=Es.create,vi=$s.create,_i=js.create,bi=Ps.create,wi=As.create,Si=Is.create,xi=qs.create,Ni=Ds.create,Ti=zs.create,Oi=Ls.create,ki=Bs.create,Ei=zs.createWithPreprocess,$i=Fs.create,ji={string:e=>is.create({...e,coerce:!0}),number:e=>os.create({...e,coerce:!0}),boolean:e=>cs.create({...e,coerce:!0}),bigint:e=>ls.create({...e,coerce:!0}),date:e=>us.create({...e,coerce:!0})},Pi=Br;var Ai=Object.freeze({__proto__:null,defaultErrorMap:Cr,setErrorMap:function(e){Ir=e},getErrorMap:qr,makeIssue:Dr,EMPTY_PATH:[],addIssueToContext:zr,ParseStatus:Lr,INVALID:Br,DIRTY:Rr,OK:Zr,isAborted:Mr,isDirty:Ur,isValid:Qr,isAsync:Fr,get util(){return kr},get objectUtil(){return Er},ZodParsedType:$r,getParsedType:jr,ZodType:Wr,ZodString:is,ZodNumber:os,ZodBigInt:ls,ZodBoolean:cs,ZodDate:us,ZodSymbol:ds,ZodUndefined:hs,ZodNull:ps,ZodAny:fs,ZodUnknown:ms,ZodNever:gs,ZodVoid:ys,ZodArray:vs,ZodObject:bs,ZodUnion:ws,ZodDiscriminatedUnion:xs,ZodIntersection:Ts,ZodTuple:Os,ZodRecord:ks,ZodMap:Es,ZodSet:$s,ZodFunction:js,ZodLazy:Ps,ZodLiteral:As,ZodEnum:Is,ZodNativeEnum:qs,ZodPromise:Ds,ZodEffects:zs,ZodTransformer:zs,ZodOptional:Ls,ZodNullable:Bs,ZodDefault:Rs,ZodCatch:Zs,ZodNaN:Ms,BRAND:Us,ZodBranded:Qs,ZodPipeline:Fs,ZodReadonly:Vs,custom:Ks,Schema:Wr,ZodSchema:Wr,late:Gs,get ZodFirstPartyTypeKind(){return Js},coerce:ji,any:ii,array:ci,bigint:Xs,boolean:ei,date:ti,discriminatedUnion:pi,effect:Ti,enum:Si,function:_i,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Ks((t=>t instanceof e),t),intersection:fi,lazy:bi,literal:wi,map:yi,nan:Hs,nativeEnum:xi,never:oi,null:si,nullable:ki,number:Ys,object:ui,oboolean:()=>ei().optional(),onumber:()=>Ys().optional(),optional:Oi,ostring:()=>Ws().optional(),pipeline:$i,preprocess:Ei,promise:Ni,record:gi,set:vi,strictObject:di,string:Ws,symbol:ni,transformer:Ti,tuple:mi,undefined:ri,union:hi,unknown:ai,void:li,NEVER:Pi,ZodIssueCode:Pr,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Ar});const Ci=Ai.union([Ai.string(),Ai.number(),Ai.boolean(),Ai.null()]),Ii=Ai.lazy((()=>Ai.union([Ci,Ai.array(Ii),Ai.record(Ii)])));function qi(e,t){const n=tt(e),r=Object.entries(n);let s=Object.fromEntries(r.map((([e,t])=>[e,zi(t)])));t&&(s=Object.assign(s,Object.fromEntries(Object.entries(t).map((([e,t])=>[e,"function"==typeof t?t(s):t])))));for(const[e,t]of r)t.notNull?t.hasDefault&&(s[e]=s[e].optional()):s[e]=s[e].nullable().optional();return Ai.object(s)}function Di(e,t){const n=tt(e),r=Object.entries(n);let s=Object.fromEntries(r.map((([e,t])=>[e,zi(t)])));t&&(s=Object.assign(s,Object.fromEntries(Object.entries(t).map((([e,t])=>[e,"function"==typeof t?t(s):t])))));for(const[e,t]of r)t.notNull||(s[e]=s[e].nullable());return Ai.object(s)}function zi(e){let n;if(function(e){return"enumValues"in e&&Array.isArray(e.enumValues)&&e.enumValues.length>0}(e)&&(n=e.enumValues.length?Ai.enum(e.enumValues):Ai.string()),!n)if(t(e,Ye))n=Ai.string().uuid();else if("custom"===e.dataType)n=Ai.any();else if("json"===e.dataType)n=Ii;else if("array"===e.dataType)n=Ai.array(zi(e.baseColumn));else if("number"===e.dataType)n=Ai.number();else if("bigint"===e.dataType)n=Ai.bigint();else if("boolean"===e.dataType)n=Ai.boolean();else if("date"===e.dataType)n=Ai.date();else if("string"===e.dataType){let r=Ai.string();(t(e,Sr)||t(e,fr)||t(e,_r)||t(e,br)||t(e,wr)||t(e,Or))&&"number"==typeof e.length&&(r=r.max(e.length)),n=r}return n||(n=Ai.any()),n}const Li=b("guild_settings",{guild_id:mr("guild_id").primaryKey(),personality:mr("personality"),usingPermissions:("usingPermissions",new class extends De{static[e]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new hr(e,this.config)}}("usingPermissions")).default(!1),name:mr("name")});const Bi=qi(Li),Ri=Di(Li);class Zi extends De{static[e]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new Mi(e,this.config)}}class Mi extends ze{static[e]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function Ui(e,t={}){return new Zi(e,t)}class Qi extends De{static[e]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fi(e,this.config)}}class Fi extends ze{static[e]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return"string"==typeof e?Number.parseInt(e):e}}const Vi=b("users",{discordId:mr("discord_id").primaryKey(),money:new Qi("money").notNull().default(0)}),Ki=qi(Vi),Gi=Di(Vi),Ji=Gi.pick({discordId:!0}),Wi=b("image_generations",{generation_id:mr("generation_id").primaryKey(),user:mr("user").references((()=>Vi.discordId)).notNull(),guild:mr("guild").notNull(),prompt:Ui("prompt").notNull(),interactionId:mr("message_id").notNull(),status:mr("status").notNull(),timestamp:Je("timestamp",{mode:"date"}).notNull().default(ge`CURRENT_TIMESTAMP`)}),Yi=qi(Wi).omit({status:!0}),Hi=Di(Wi),Xi=H(Wi,(({many:e})=>({generation_results:e(ea)}))),ea=b("image_generation_results",{image_id:mr("image_id").primaryKey(),generation_id:mr("generation_id").references((()=>Wi.generation_id)).notNull(),image_url:Ui("image_url").notNull(),upscaled_image_url:Ui("upscaled_image_url")}),ta=qi(ea),na=H(ea,(({one:e})=>({image_generation:e(Wi,{fields:[ea.generation_id],references:[Wi.generation_id]})}))),ra=Symbol.for("drizzle:isPgEnum");class sa extends De{static[e]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new ia(e,this.config)}}class ia extends ze{static[e]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}const aa=function(e,t){const n=Object.assign((e=>new sa(e,n)),{enumName:"role",enumValues:["admin","manager","normal"],[ra]:!0});return n}(),oa=b("permissions",{guild_id:mr("guild_id"),role:aa("role"),group_id:mr("group_id")},(e=>({pk:w({columns:[e.group_id,e.guild_id,e.role]})}))),la=Di(oa),ca=qi(oa),ua=Ai.enum(aa.enumValues),da=b("uploaded_images",{image_id:mr("image_id").primaryKey(),user:mr("user").references((()=>Vi.discordId)).notNull(),image_url:Ui("image_url").notNull(),image_name:Ui("image_name").notNull(),timestamp:Je("timestamp",{mode:"date"}).notNull().default(ge`CURRENT_TIMESTAMP`)},(e=>({unique:{user_image_name:{columns:[e.user,e.image_name]}}}))),ha=Di(da),pa=qi(da).omit({timestamp:!0}),fa=b("upscaled_images",{variation_id:mr("variation_id").primaryKey(),upscaled_by:mr("upscaled_by").references((()=>Vi.discordId)).notNull(),image_url:mr("image_url").notNull(),original_image:mr("original_image").references((()=>ea.image_id)).notNull(),timestamp:Je("timestamp").notNull().default(ge`CURRENT_TIMESTAMP`)}),ma=qi(fa).omit({timestamp:!0}),ga=qi(fa);class ya extends De{static[e]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new va(e,this.config)}}class va extends ze{static[e]="PgSerial";getSQLType(){return"serial"}}const _a=b("user_informations",{id:new ya("id").primaryKey(),user:mr("user").references((()=>Vi.discordId)).notNull(),guild:mr("guild").notNull(),information:mr("information").notNull(),timestamp:Je("timestamp",{mode:"date"}).notNull().default(ge`CURRENT_TIMESTAMP`)}),ba=qi(_a).omit({timestamp:!0}),wa=qi(_a).pick({user:!0,information:!0,guild:!0}),Sa=Di(_a),xa=async e=>{console.log("Inserting generation results"),await io.insert(ea).values(e)},Na=async e=>(console.log(`Getting generation results for discord id: ${e}`),await io.query.image_generations.findMany({columns:{prompt:!0,timestamp:!0},with:{generation_results:{columns:{image_url:!0}}},where:T(Wi.user,e)})),Ta=async(e,t,n)=>(console.log("Page: ",t),console.log("Page size: ",n),null!=t&&n?(console.log(`Getting generation results for discord id: ${e}`),await io.query.image_generations.findMany({columns:{prompt:!0,timestamp:!0},with:{generation_results:{columns:{image_url:!0}}},where:T(Wi.user,e),orderBy:[K(Wi.timestamp)],limit:n,offset:t*n})):(console.log("Missing page or pageSize"),Na(e))),Oa=async(e,t)=>(console.log(`Getting generation results for discord id: ${e} within guild: ${t}`),await io.query.image_generations.findMany({columns:{prompt:!0,timestamp:!0},with:{generation_results:{columns:{image_url:!0}}},where:k(T(Wi.user,e),T(Wi.guild,t))})),ka=async(e,t)=>{const n=await io.select({value:ge`count(${ge.raw("*")})`.mapWith(Number)}).from(Wi).where(T(Wi.user,e)).limit(1);const r=n[0].value?n[0].value:0;return Math.ceil(r/t)},Ea=async e=>{console.log(`Inserting generation with id: ${e.generation_id}`),await io.insert(Wi).values({...e,status:"done"})},$a=async(e,t)=>{console.log(`Updating generation status to ${t}`),await io.update(Wi).set({status:t}).where(T(Wi.generation_id,e))},ja=async e=>{console.log(`Inserting guild settings with id: ${e.guild_id}`),await io.insert(Li).values(e)},Pa=async e=>await io.query.guild_settings.findFirst({where:T(Li.guild_id,e)})||null,Aa=async(e,t)=>{console.log(`Updating guild settings with id: ${e}`),await io.update(Li).set(t).where(T(Li.guild_id,e))},Ca=async(e,t)=>{await Pa(e)?await Aa(e,t):await ja(t)},Ia=async e=>{console.log(`Inserting permissions with id: ${oa.guild_id}`),await io.insert(oa).values(e)},qa=async(e,t)=>{await io.delete(oa).where(k(T(oa.guild_id,e),T(oa.role,"manager"))),await io.insert(oa).values({guild_id:e,role:"manager",group_id:t})},Da=async e=>{await io.delete(oa).where(k(T(oa.guild_id,e),T(oa.role,"manager")))},za=async(e,t)=>{await io.insert(oa).values({guild_id:e,role:"normal",group_id:t})},La=async(e,t)=>{await io.delete(oa).where(k(T(oa.guild_id,e),T(oa.group_id,t)))},Ba=async e=>await io.query.permissions.findMany({where:k(T(oa.guild_id,e),T(oa.role,"manager"))})||null,Ra=async e=>await io.query.permissions.findMany({where:k(T(oa.guild_id,e),T(oa.role,"normal"))})||null,Za=async(e,t)=>await io.query.permissions.findFirst({where:k(T(oa.guild_id,e),T(oa.group_id,t))})||null,Ma=async(e,t,n)=>!!await io.query.permissions.findFirst({where:k(T(oa.guild_id,e),I(oa.group_id,t),T(oa.role,n))}),Ua=async(e,t)=>!await io.query.permissions.findFirst({where:k(T(oa.guild_id,e),T(oa.role,"normal"))})||await Ma(e,t,"normal"),Qa=async(e,t)=>await io.query.permissions.findFirst({where:k(T(oa.guild_id,e),T(oa.role,"normal"))})?await Ma(e,t,"manager")?"manager":await Ma(e,t,"normal")?"normal":"none":"normal",Fa=async(e,t,n)=>{await io.delete(oa).where(T(oa.guild_id,e));for(const n of t)await io.insert(oa).values({guild_id:e,role:"manager",group_id:n});for(const t of n)await io.insert(oa).values({guild_id:e,role:"normal",group_id:t})},Va=async e=>{console.log(`Inserting uploaded image with id: ${e.image_id}`),await io.insert(da).values(e)},Ka=async e=>(console.log(`Getting uploaded image for user: ${e}`),await io.query.uploaded_images.findMany({where:T(da.user,e)})),Ga=async(e,t)=>(console.log(`Getting uploaded image for user: ${e}`),await io.query.uploaded_images.findFirst({where:k(T(da.user,e),T(da.image_name,t))})),Ja=async e=>await io.query.upscaled_images.findFirst({where:T(fa.original_image,e)})||null,Wa=async e=>{console.log(`Inserting upscaled image with id: ${e.original_image}`),await io.insert(fa).values(e)};n(371);const Ya=async e=>{console.log(`Getting user by discord id: ${e}`);return await io.query.users.findFirst({where:T(Vi.discordId,e)})||null},Ha=async e=>(console.log(`Inserting user with discord id: ${e}`),(await io.insert(Vi).values({discordId:e,money:Number(process.env.STARTING_MONEY||0)}).onConflictDoNothing().returning())[0]),Xa=async e=>(await Ya(e.user)||await Ha(e.user),console.log(`Inserting user information: ${e}`),(await io.insert(_a).values(e).returning())[0]),eo=async e=>(console.log(`Getting user information for discord id: ${e}`),await io.query.userInformations.findMany({where:T(_a.user,e),orderBy:K(_a.timestamp),limit:30})),to=async(e,t)=>(console.log(`Getting user information for discord id: ${e}`),await io.query.userInformations.findMany({where:k(T(_a.user,e),T(_a.guild,t)),orderBy:K(_a.timestamp),limit:30}));dr().config();const no=process.env.DATABASE_URL;if(!no)throw new Error("DATABASE_URL not found in .env file");const ro={users:Vi,image_generations:Wi,image_generation_results:ea,upscaled_images:fa,guild_settings:Li,uploaded_images:da,userInformations:_a,imageGenerationRelations:Xi,imageGenerationResultsRelations:na,permissions:oa},so=ir(no,{prepare:!1}),io=function(e,n={}){const r=new st;let s,a;if(!0===n.logger?s=new i:!1!==n.logger&&(s=n.logger),n.schema){const e=function(e,n){1===Object.keys(e).length&&"default"in e&&!t(e.default,g)&&(e=e.default);const r={},s={},i={};for(const[o,l]of Object.entries(e))if("object"==typeof(a=l)&&null!==a&&m in a){const e=l[g.Symbol.Name],n=s[e];r[e]=o,i[o]={tsName:o,dbName:l[g.Symbol.Name],schema:l[g.Symbol.Schema],columns:l[g.Symbol.Columns],relations:n?.relations??{},primaryKey:n?.primaryKey??[]};for(const e of Object.values(l[g.Symbol.Columns]))e.primary&&i[o].primaryKey.push(e);const a=l[g.Symbol.ExtraConfigBuilder]?.(l);if(a)for(const e of Object.values(a))t(e,S)&&i[o].primaryKey.push(...e.columns)}else if(t(l,J)){const e=l.table[g.Symbol.Name],t=r[e],a=l.config(n(l.table));let o;for(const[n,r]of Object.entries(a))if(t){const e=i[t];e.relations[n]=r,o&&e.primaryKey.push(...o)}else e in s||(s[e]={relations:{},primaryKey:o}),s[e].relations[n]=r}var a;return{tables:i,tableNamesMap:r}}(n.schema,ne);a={fullSchema:n.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}const o=new Ct(e,r,a,{logger:s});return new Et(r,o,a)}(so,{schema:ro})})(),r})()));